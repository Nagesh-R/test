var dropDownList;
var addOnArr=[];
//var addOnMap={};
var addOnMap = new Object();
var checkedHotelsMap = new Object(); 																																										qaqq = new Object();



var reservationModule=angular.module('reservationModule',['ngRoute']);
reservationModule.config(function($routeProvider, $locationProvider){
$routeProvider
    /** set route for the index page and it load uirouter.html
    *in ng-view and activate RouteCtrl
    **/
    .when('/', {
        controller: 'hotelSelectionController',
        templateUrl: '/etc/designs/reservationPartials/pages/hotelSelectionPage.html'
    })
	.when('/roomSelection', {
        controller: 'roomSelectionController',
        templateUrl: '/etc/designs/reservationPartials/pages/roomSelection.html'
    })
	.when('/customizeYourStay', {
        controller: 'customizeYourStayController',
        templateUrl: '/etc/designs/reservationPartials/pages/customizeYourStay.html'
    })
	.when('/personalDetails', {
        controller: 'personalDetailsPageController',
        templateUrl: '/etc/designs/reservationPartials/pages/personalDetails.html'
    })
    .when('/reviewAndPay', {
        controller: 'reviewAndPayController',
        templateUrl: '/etc/designs/reservationPartials/pages/bookingSummary.html'
    })
    .when('/compareHotels', {
            controller: 'compareHotelsController',
            templateUrl: '/etc/designs/reservationPartials/pages/compareHotels.html'
        })

    // if not match with any route config then send to home page
    .otherwise({
        templateUrl: '/etc/designs/reservationPartials/pages/hotelSelectionPage.html'
    });
});


//Hotel Selection page
//controllers
//controller to populate dropdown values of destination/hotels/airport
reservationModule.controller('hotelSelectionController',['$location','$scope','hotelSelectionFactory','commonDataSharingFactory',function($location,$scope,hotelSelectionFactory,commonDataSharingFactory){
	var hotelSearchResult=commonDataSharingFactory.getPreviousTabData();
	if(hotelSearchResult!=undefined)
	{
	var data=JSON.parse(hotelSearchResult);
	$scope.hotelSearchResults=data;
	}
	$('#roomRatesPage').removeClass('act');
	$('#roomRatesPage1').removeClass('act');
	$('#customizeYourStayPage').removeClass('act');
	$('#customizeYourStayPage1').removeClass('act');
	$('#personalDetailsPage').removeClass('act');
	$('#personalDetailsPage1').removeClass('act');
	$('#summaryPage').removeClass('act');
	$('#summaryPage1').removeClass('act');

	//function to set location in input and fetch location id from dropdown
    $scope.capLet=function(location){
        var currVal = location;
        //$scope.locationId=locationId;
        //$scope.Location=location;
        $('#destinationSelection').val(currVal);
        $('.slctLst').hide();
    };
    // functions to make the dropdown work for promo code
    $('.itc_custom_input').keyup(function(e) {

    		var search = $.trim($(this).val());
    		$(this).parent().parent().find('.noresult').hide();
    		$(this).parent().parent().find('.autoSugg').show();


    		$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    			if(!$(v).attr('data-rel')) {
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			}
    		});

    		if(search != '') {
    			search = search.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')
    			var filter = new RegExp("(.*)("+search+")(.*)", "ig");
    			var brk = null;
    			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    				var datarel = $(v).attr('data-rel');
    				if(filter.test($.trim(datarel)) && brk== null) {
    					$(v).siblings().removeClass('drpAct');
    					$(v).addClass('drpAct');
    					$('.autoSuggCont').scrollTo('.drpAct');
    					brk = 1;
    					$(v).find('a').html(datarel.replace(filter,'$1<b>$2</b>$3'));
    				} else {
    					$(v).find('a').html(datarel);
    					$(v).removeClass('drpAct');
    				}
    			});
    			if(brk == null) {
    				$(this).parent().parent().find('.noresult').show();
    				$(this).parent().parent().find('.autoSugg').hide();
    				$(this).closest('.selcArp').removeClass('act');
    			}
    		} else {
    			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});

    			$(this).parent().parent().find('.autoSugg li').show();
    			$(this).parent().parent().find('.autoSugg li.drpAct').removeClass('drpAct');
    		}

    		if(e.keyCode == 13) {
    			var currLi =  $('.autoSugg:visible li.drpAct');
    			capLet(currLi);
    			$(currLi).closest('.autoSugg').hide();
    			$('.selcArp').removeClass('act');// supproting files
    		}

    		// down
    		if(e.keyCode == 40) {
    			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});
    			downArr();
    			return false;
    		}

    		//up
    		if(e.keyCode == 38) {
    			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});
    			upArr(this);
    			return false;
    		}

    		//delete
    		if(e.keyCode == 8) {
    			$(this).parent().find('.autoSugg').slideDown();
    			$('.selcArp').addClass('act');// supproting files
    			$(this).parent().find('.autoSugg').scrollTo('.drpAct');
    		}

    }).
    on("click", function(e) {
    	$(this).next().addClass('cls');
    	$('.autoSugg').hide();
    	$(this).parent().parent().find('.autoSugg').show();
    	$(this).parent().parent().find('.autoSugg').jScrollPane();
    	$(this).parent().parent().find('.noresult').hide();

    }).on("focus", function(e) {
    	$(this).next().addClass('cls');
    	$('.autoSugg').hide();
    	$(this).parent().parent().find('.autoSugg').show();
    	$(this).parent().parent().find('.autoSugg').jScrollPane();
    	$(this).parent().parent().find('.noresult').hide();

    });

    //function to add drpAct class on hovered option in dropdown
    $('.autoSugg li').hover(function() {
    	$('.autoSugg:visible li').removeClass('drpAct');
    	$(this).addClass('drpAct');
    });
    // function to set the selected promo type
    $scope.promo=function(promotype){
        $('#hotelSelectionPromoType').val(promotype);
        $('.slctnLst').hide();
        $('#promoTypeArrow').removeClass('cls');
    };
    //function for calender to work

	$("#resCheckIn").datepick({
        minDate: 0,
        rangeSelect: false,
        changeMonth: false,
        defaultDate: GL_checkInDate[0],
        selectDefaultDate: true,
        onSelect:function (d){
            $('.checkIn .day').text(monthNames[d[0].getMonth()]);
            $('.checkIn .date').text(d[0].getDate());
            $('.checkIn .year').text(d[0].getFullYear());

            $("#resCheckOut").datepick('option', {minDate:d[0]});
            $('.resCheckInWp').hide();
            $("#resCheckIn .dp"+d[0].getTime()).addClass("datepick-selected");

            var _n = new Date(d[0]);
            _n.setDate(d[0].getDate() + 1);
            $("#resCheckOut").datepick('setDate',_n);
        }
    });
    //$("#resCheckIn .dp"+GL_checkInDate[0].getTime()).addClass("datepick-selected");


    $("#resCheckOut").datepick({
        minDate: 0,
        rangeSelect: false,
        changeMonth: false,
        onDate: codates,
        onSelect:function (dates){
            $('.checkOut .day').text(monthNames[dates[0].getMonth()]);
            $('.checkOut .date').text(dates[0].getDate());
            $('.checkOut .year').text(dates[0].getFullYear());
            //$('#resCheckOut .datepick-selected').removeClass('datepick-selected');
            //$("#resCheckOut .dp"+GL_checkInDate[0].getTime()).addClass("datepick-selected");
            $('.resCheckInWp').hide();
        },
        onShow: $.datepick.hoverCallback(showHoverDays)
    });


	commonDataSharingFactory.setIsPromoRatePlan=false;



	hotelSelectionFactory.GetDestinations().then(function(){
            $scope.destinationDropdownValues=JSON.parse(localStorage.getItem('DestinationsOnline'));
	});

	var reservationWidget=localStorage.getItem("reservationWidget");
    if(commonDataSharingFactory.getRoomRedirect()==false){
        if(!(reservationWidget==undefined))
        {
            if(reservationWidget=='true')
            {
                localStorage.removeItem("reservationWidget");
                hotelSelectionFactory.GetHotelSearchResults("",'onload').then(function(data){
                var monthCheckinResLan= moment(localStorage.getItem("checkInDateRes"),"YYYY-MM-DD").format("MMMM");
                var yearCheckinResLan=moment(localStorage.getItem("checkInDateRes"),"YYYY-MM-DD").format("YYYY");
                var dateCheckinResLan=moment(localStorage.getItem("checkInDateRes"),"YYYY-MM-DD").format("DD");
                $('#checkinMonth').text(monthCheckinResLan);
                $('#checkinYear').text(yearCheckinResLan);
                $('#checkinDay').text(dateCheckinResLan);
                var monthCheckOutResLan= moment(localStorage.getItem("checkOutDateRes"),"YYYY-MM-DD").format("MMMM");
                var yearCheckOutResLan=moment(localStorage.getItem("checkOutDateRes"),"YYYY-MM-DD").format("YYYY");
                var dateCheckOutResLan=moment(localStorage.getItem("checkOutDateRes"),"YYYY-MM-DD").format("DD");
                $('#checkoutDay').text(dateCheckOutResLan);
                $('#checkoutMonth').text(monthCheckOutResLan);
                $('#checkoutYear').text(yearCheckOutResLan);
                localStorage.setItem("checkinDate",localStorage.getItem("checkInDateRes"));
                localStorage.setItem('checkoutDate',localStorage.getItem("checkOutDateRes"));
                localStorage.setItem('adults',localStorage.getItem("numberOfAdults"));
                localStorage.setItem('rooms',localStorage.getItem("numberOfRooms"));
                localStorage.setItem('childrens','0');
                //$scope.hotelSearchResults=data;
                $scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));

                });
            }
        }
    }
    if(commonDataSharingFactory.getRoomRedirect()==true){
        $('#destinationSelection').val(localStorage.getItem('destination'));
        $('#checkinDay').text(localStorage.getItem('checkinDay'));
        $('#checkinMonth').text(localStorage.getItem('checkinMonth'));
        $('#checkinYear').text(localStorage.getItem('checkinYear'));
        $('#checkoutDay').text(localStorage.getItem('checkOutDay'));
        $('#checkoutMonth').text(localStorage.getItem('checkOutMonth'));
        $('#checkoutYear').text(localStorage.getItem('checkOutYear'));
        $('#reservationAdults').val(localStorage.getItem('adults'));
        $('#reservationRooms').val(localStorage.getItem('rooms'));
        $('#reservationChildren').val(localStorage.getItem('children'));
        hotelSelectionFactory.GetHotelSearchResults().then(function(data){
        			//$scope.hotelSearchResults=data;
        			$scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));
        			$scope.hotelSearchResultsForFilters=JSON.parse(localStorage.getItem('hotelSearchResults'));
        			$('.se-pre-con').hide();


                });
        commonDataSharingFactory.setRoomRedirect(false);
    }


	hotelSelectionFactory.getDropDownValues().then(function(data){
        hotelSelectionFactory.appendDropDownValues(data);
        $scope.dropDownList=data;
        dropDownList=data;
        data=JSON.stringify(data);
        commonDataSharingFactory.setDropdownValuesList(data);
        data=JSON.parse(data);



        console.log(JSON.stringify(data));

        });

    $scope.setCheckedList=function(hotelType,hotelPagePath,chainCode,hotelCode,hotelId,amount,thisObj)
    {
        var propertyMap = new Object();
        //alert(thisObj.checkSelected);
        if(thisObj.checkSelected==true)
        {
			if(hotelType=='online')
            {
                if (!(hotelCode in checkedHotelsMap))
                {
					propertyMap['hotelType']=hotelType;
					propertyMap['hotelPagePath']=hotelPagePath;
                    propertyMap['chainCode']=chainCode;
                    propertyMap['hotelCode']=hotelCode;
                    propertyMap['amount']=amount;
                    checkedHotelsMap[hotelCode]=propertyMap;
        		}
				//checkedHotelsMap[hotelCode]=propertyMap;
            }
            else if(hotelType=='offline')
            {
				if (!(hotelId in checkedHotelsMap))
                {
					propertyMap['hotelType']=hotelType;
					propertyMap['hotelPagePath']=hotelPagePath;
                    propertyMap['amount']=amount;
                    checkedHotelsMap[hotelId]=propertyMap;
        		}
				//checkedHotelsMap[hotelId]=propertyMap;
            }
        }
        else
        {
            if(hotelType=='online')
            {
				delete checkedHotelsMap[hotelCode];
            }
            else if(hotelType=='offline')
            {
				delete checkedHotelsMap[hotelId];
            }
        }
    }

    $scope.compareHotels=function()
    {
		hotelSelectionFactory.getCheckedHotelsDetails(checkedHotelsMap).then(function(data)
        {
			//alert(data);
			commonDataSharingFactory.setCompareHotelsDetails(data);
			var checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
                    var checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
            		localStorage.setItem('destination',$('#destinationSelection').val());
                    localStorage.setItem('checkinDate',checkinDate);
            		localStorage.setItem('checkoutDate',checkoutDate);
                    localStorage.setItem('checkinDay',$('#checkinDay').text());
                    localStorage.setItem('checkinMonth',$('#checkinMonth').text());
                    localStorage.setItem('checkinYear',$('#checkinYear').text());
                    localStorage.setItem('checkOutDay',$('#checkoutDay').text());
                    localStorage.setItem('checkOutMonth',$('#checkoutMonth').text());
                    localStorage.setItem('checkOutYear',$('#checkoutYear').text());
            		var adults='';
                    var rooms='';
                    var children='';
                    if($('#reservationAdults').val()=='')
                    {
                        adults=1;
                    }
                    else
                    {
                        adults=$('#reservationAdults').val();
                    }
                    if($('#reservationRooms').val()=='')
                    {
                        rooms=1;
                    }else{
                        rooms=$('#reservationRooms').val();
                    }
                    if($('#reservationChildren').val()=='')
                    {
                        children=0;
                    }else{
                        children=$('#reservationChildren').val();
                    }
                    localStorage.setItem('rooms',rooms);
                    localStorage.setItem('adults',adults);
                    localStorage.setItem('children',children);

			$location.path('/compareHotels');
        });

    }

    $scope.showToolTipMessage=function()
    {
        var checkedCount=0;
        if($(window).width()>1263) {
        		$('.chkCnWp').hover(function() {
        			$(this).find('.toltip').show();
        		},function () {
        			$(this).find('.toltip').hide();
        		});
        	}else {
        		$('.chkCnWp .lab2').on('click',function () {
        			console.log('clicked');
        			if ($(this).hasClass('act')) {
        				$(this).closest('.chkCnWp').find('.toltip').hide();
        				$(this).removeClass('act');
        			} else {
        				$(this).closest('.chkCnWp').find('.toltip').show();
        				$(this).addClass('act');
        			}
        		});
        	}


        $('#hotelListRes input:checked').each(function() {
    	++checkedCount;
		});

        if(checkedCount>3)
        {
			$(".reservationToolTip").html("more than three hotels cannot be compared");
            $(".compareLabel").attr("style","pointer-events: none;");
        }
        else if(checkedCount>1)
        {
			$(".reservationToolTip").html("Please select at least two hotels to compare");
            $(".compareLabel").attr("style","pointer-events: block;");

        }
        else
        {
			$(".reservationToolTip").html("Please select at least two hotels to compare");
            $(".compareLabel").attr("style","pointer-events: none;");
        }

    };




    //function to fetch search results from refine your search block on button click function
    $scope.getHotelSearchResults=function(){
        hotelSelectionFactory.GetHotelSearchResults().then(function(data){
			//$scope.hotelSearchResults=data;
			commonDataSharingFactory.setPreviousTabData((localStorage.getItem('hotelSearchResults')));
			$scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));
			$scope.hotelSearchResultsForFilters=JSON.parse(localStorage.getItem('hotelSearchResults'));
			$('.se-pre-con').hide();


        });
    }
    //function to change view
    $scope.redirectToRoomSelectionPage=function(hotelCategory,chainCode,hotelCode,hotelPagePath,hotelId,hotelName,hotelEmail,hotelPhone,hotelAddress,hotelLocation){
		commonDataSharingFactory.setHotelCategory(hotelCategory);
		commonDataSharingFactory.setChainCode(chainCode);
		commonDataSharingFactory.setHotelCode(hotelCode);
        commonDataSharingFactory.setHotelPagePath(hotelPagePath);
		commonDataSharingFactory.setHotelName(hotelName);
		commonDataSharingFactory.setHotelId(hotelId);
        commonDataSharingFactory.setHotelAddress1(hotelAddress);
        commonDataSharingFactory.setHotelPhone(hotelPhone);
        commonDataSharingFactory.setHotelEmail(hotelEmail);
        commonDataSharingFactory.setHotelLocation(hotelLocation);
        if(hotelCategory=='online')
        {
			if(hotelId=='ratePlan')
            {
				commonDataSharingFactory.setIsPromoRatePlan=true;
            }
            else
            {
				commonDataSharingFactory.setIsPromoRatePlan=false;
            }
        }
        else
        {
			commonDataSharingFactory.setIsPromoRatePlan=false;
        }
		commonDataSharingFactory.setHotelLocation($scope.Location);
        var checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
        var checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
		localStorage.setItem('destination',$('#destinationSelection').val());
        localStorage.setItem('checkinDate',checkinDate);
		localStorage.setItem('checkoutDate',checkoutDate);
        localStorage.setItem('checkinDay',$('#checkinDay').text());
        localStorage.setItem('checkinMonth',$('#checkinMonth').text());
        localStorage.setItem('checkinYear',$('#checkinYear').text());
        localStorage.setItem('checkOutDay',$('#checkoutDay').text());
        localStorage.setItem('checkOutMonth',$('#checkoutMonth').text());
        localStorage.setItem('checkOutYear',$('#checkoutYear').text());
		var adults='';
        var rooms='';
        var children='';
        if($('#reservationAdults').val()=='')
        {
            adults=1;
        }
        else
        {
            adults=$('#reservationAdults').val();
        }
        if($('#reservationRooms').val()=='')
        {
            rooms=1;
        }else{
            rooms=$('#reservationRooms').val();
        }
        if($('#reservationChildren').val()=='')
        {
            children=0;
        }else{
            children=$('#reservationChildren').val();
        }
        localStorage.setItem('rooms',rooms);
        localStorage.setItem('adults',adults);
        localStorage.setItem('children',children);
        localStorage.setItem('hotelId',hotelId);
		$location.path('/roomSelection')
    }

    $('.plIc,.mnIc').click(function(e) {
        e.preventDefault();
        counting(this);
   	});

    function counting(arg) {
        var inpField = $(arg).closest('.rsrvDtailWp').find('.itc_custom_input');
        var tarEleLen;
        if( pageName == 'reservation') {
        // this section is only for reservation page
            // stting upper limit for room,adultand children
            if($(arg).closest('.slctn').hasClass('roomJs')) {
                tarEleLen = 9;
            } else {
                tarEleLen = 18;
            }

            var inpval = $(inpField).val();
            var labelTxt = $(arg).closest('.slctn').find('.hdng').html();
            var label = $(arg).closest('.slctn').find('.hdng');

            if($(arg).hasClass('plIc')) {
                // pluus icon
                if($(label).hasClass('act')) {
                }else {
                    if(labelTxt == 'Children') {
                    }else {
                        $(label).html(labelTxt+'s');
                        $(label).addClass('act');
                    }
                }
                $(arg).next().removeClass('inAct');
                if (inpval == '') {
                    inpval = 2;
                    $(inpField).val('2');
                }else {
                    if(inpval ==  tarEleLen) {return;}
                    inpval = Number(inpval);
                    inpval++;
                    $(inpField).val(inpval);
                    if(inpval ==  tarEleLen) { $(arg).addClass('inAct');}
                }
            }else {
                // minus icon
                if (inpval == '') {
                    return;
                }else {
                    if(inpval ==  '1') {  return;}
                    $(arg).prev().removeClass('inAct');
                    inpval = Number(inpval);
                    inpval--;
                    $(inpField).val(inpval);
                    if(inpval ==  '1') {
                        if(labelTxt == 'Children') {
                        }else {
                            labelTxt=labelTxt.slice(0,-1);
                            $(label).html(labelTxt);
                            $(label).removeClass('act');
                        }
                        $(arg).addClass('inAct');
                    }
                }
            }
        } else {
            // this section is only for rest of the  pages at present home and hotel level pages
            var tarEle = $(arg).closest('.rsrvDtailWp').find('.prmCDd li');
            var index =  $(arg).closest('.rsrvDtailWp').find('.prmCDd li.drpAct').index();
            tarEleLen = tarEle.length;
            var lastVal = $(tarEle[tarEleLen-1]).children().html();
            var firstVal = $(tarEle[0]).children().html();

            if($(arg).hasClass('plIc')) {
                console.log(index);
                if((index+1) ==  tarEleLen) { return; }
                $(arg).next().removeClass('inAct');
                var res =  $(tarEle[index+1]).children().html();
                $(inpField).val(res);
                $(tarEle).removeClass('drpAct');
                $(tarEle[index+1]).addClass('drpAct');
                if($(inpField).val() == lastVal) { $(arg).addClass('inAct');}
            } else {
                console.log(index);
                if((index) == 0) { return  };
                $(arg).prev().removeClass('inAct');
                var res =  $(tarEle[index-1]).children().html();
                $(inpField).val(res);
                $(tarEle).removeClass('drpAct');
                $(tarEle[index-1]).addClass('drpAct');
                if($(inpField).val() == firstVal) { $(arg).addClass('inAct');}
            }
        }


    }

    $scope.refineYourSearch=function(){
		$scope.hotelSearchResultsForFilters=JSON.parse(localStorage.getItem('hotelSearchResults'));
		var brandsToFilter=[];
		var hotels=[];


        if($scope.itcHotels == true){
            //$scope.brandFilter={hotelCategory : "O"};
			brandsToFilter.push('O');
        }
        if($scope.sheratonOrWelcomHotels == true){
            //$scope.brandFilter={hotelCategory : "9"};
            //$scope.brandFilter1={hotelCategory : "2"} ;
			brandsToFilter.push('9');
			brandsToFilter.push('2');
        }
        if($scope.fortuneHotels == true){
			//$scope.brandFilter={hotelCategory : "4"};
			brandsToFilter.push('4');
        }
        if($scope.welcomHeritage == true){
			//$scope.brandFilter={hotelCategory : "3"};
			brandsToFilter.push('3');
        }
        if($scope.allHotelBrands == true){
           brandsToFilter=[];
           $scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));
        }
        if(brandsToFilter.length > 0){
            $scope.hotelSearchResultsForFilters=JSON.parse(localStorage.getItem('hotelSearchResults'));
            if(brandsToFilter.length == 1){
                $.each($scope.hotelSearchResultsForFilters.data.hotels,function (index, value){
                    var filter = brandsToFilter[0];
                    if(value.hotelCategory==filter){
                        hotels.push(value);
                    }
                });
                $scope.hotelSearchResults.data.hotels=hotels;
            }
            if(brandsToFilter.length == 2){
                $.each($scope.hotelSearchResultsForFilters.data.hotels,function (index, value){
                    var filter = brandsToFilter[0];
                    var filter1 = brandsToFilter[1];
                    if(value.hotelCategory==filter || value.hotelCategory==filter1){
                        hotels.push(value);
                    }
                });
                $scope.hotelSearchResults.data.hotels=hotels;
            }
            if(brandsToFilter.length == 3){
                $.each($scope.hotelSearchResultsForFilters.data.hotels,function (index, value){
                    var filter = brandsToFilter[0];
                    var filter1 = brandsToFilter[1];
                    var filter2 = brandsToFilter[2];
                    if(value.hotelCategory==filter || value.hotelCategory==filter1 || value.hotelCategory==filter2){
                        hotels.push(value);
                    }
                });
                $scope.hotelSearchResults.data.hotels=hotels;
            }
            if(brandsToFilter.length == 4){
                $.each($scope.hotelSearchResultsForFilters.data.hotels,function (index, value){
                    var filter = brandsToFilter[0];
                    var filter1 = brandsToFilter[1];
                    var filter2 = brandsToFilter[2];
                    var filter3 = brandsToFilter[3];
                    if(value.hotelCategory==filter || value.hotelCategory==filter1 || value.hotelCategory==filter2 || value.hotelCategory==filter3){
                        hotels.push(value);
                    }
                });
                $scope.hotelSearchResults.data.hotels=hotels;
            }
            if(brandsToFilter.length == 5){
                $.each($scope.hotelSearchResultsForFilters.data.hotels,function (index, value){
                    var filter = brandsToFilter[0];
                    var filter1 = brandsToFilter[1];
                    var filter2 = brandsToFilter[2];
                    var filter3 = brandsToFilter[3];
                    var filter4 = brandsToFilter[4];
                    if(value.hotelCategory==filter || value.hotelCategory==filter1 || value.hotelCategory==filter2 || value.hotelCategory==filter3 || value.hotelCategory==filter4){
                        hotels.push(value);
                    }
                });
                $scope.hotelSearchResults.data.hotels=hotels;
            }
        }else{
            $scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));
        }

        if($scope.airportDistance15==undefined){
            $scope.airportDistance15=false;
        }
        if($scope.airportDistance30==undefined){
            $scope.airportDistance30=false;
        }
        if($scope.airportDistanceAbove30==undefined){
            $scope.airportDistanceAbove30=false;
        }
        if($scope.airportDistanceAll==undefined){
            $scope.airportDistanceAll=false;
        }
        if($scope.airportDistance15==true && ($scope.airportDistance30==false && $scope.airportDistanceAbove30==false && $scope.airportDistanceAll==false)){
            var airport1=0;
            var airport2=15;
            var hotels=[];
            $.each($scope.hotelSearchResults.data.hotels,function (index, value){
                if(value.distanceFromAirport >= airport1 && value.distanceFromAirport <=airport2){
                    hotels.push(value);
                }
            });
            $scope.hotelSearchResults.data.hotels=hotels;
        }
        if($scope.airportDistance30==true && ($scope.airportDistance15==false && $scope.airportDistanceAbove30==false && $scope.airportDistanceAll==false)){
            var airport1=15;
            var airport2=30;
            var hotels=[];
            $.each($scope.hotelSearchResults.data.hotels,function (index, value){
                if(value.distanceFromAirport >= airport1 && value.distanceFromAirport <=airport2){
                    hotels.push(value);
                }
            });
            $scope.hotelSearchResults.data.hotels=hotels;
        }
        if($scope.airportDistanceAbove30==true && ($scope.airportDistance15==false && $scope.airportDistance30==false &&  $scope.airportDistanceAll==false)){
            var airport1=30;
            //var airport2=30;
            var hotels=[];
            $.each($scope.hotelSearchResults.data.hotels,function (index, value){
                if(value.distanceFromAirport >= airport1){
                    hotels.push(value);
                }
            });
            $scope.hotelSearchResults.data.hotels=hotels;
        }
        if($scope.airportDistance15==true && $scope.airportDistance30==true && ($scope.airportDistanceAbove30==false && $scope.airportDistanceAll==false)){
            var airport1=0;
            var airport2=15;
            var airport3=30
            var hotels=[];
            $.each($scope.hotelSearchResults.data.hotels,function (index, value){
                if((value.distanceFromAirport >= airport1 && value.distanceFromAirport <=airport2)||(value.distanceFromAirport >= airport2 && value.distanceFromAirport <=airport3)){
                    hotels.push(value);
                }
            });
            $scope.hotelSearchResults.data.hotels=hotels;
        }
        if($scope.airportDistance15==true && $scope.airportDistanceAbove30==true && ( $scope.airportDistance30==false && $scope.airportDistanceAll==false)){
            var airport1=0;
            var airport2=15;
            var airport3=30
            var hotels=[];
            $.each($scope.hotelSearchResults.data.hotels,function (index, value){
                if((value.distanceFromAirport >= airport1 && value.distanceFromAirport <=airport2)||(value.distanceFromAirport >= airport3)){
                    hotels.push(value);
                }
            });
            $scope.hotelSearchResults.data.hotels=hotels;
        }
        if($scope.airportDistance30==true && $scope.airportDistanceAbove30==true && ($scope.airportDistance15==false && $scope.airportDistanceAll==false)){
            //var airport1=0;
            var airport2=15;
            var airport3=30
            var hotels=[];
            $.each($scope.hotelSearchResults.data.hotels,function (index, value){
                if((value.distanceFromAirport >= airport2 && value.distanceFromAirport <=airport3)||(value.distanceFromAirport >= airport3)){
                    hotels.push(value);
                }
            });
            $scope.hotelSearchResults.data.hotels=hotels;
        }
        if(brandsToFilter.length <= 0 && $scope.airportDistanceAll==true){
            $scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));
        }
        /*if($scope.airportDistance30==true){
            airport3=15;
            airport4=30;
        }
        if($scope.airportDistanceAbove30==true){
           airport5=30
        }*/


    }



    //$scope.priceLowToHigh=function(){
		//$scope.myRateOrder='hotelMinRate'
    //}

   /*function putSelectedValue(data){
        $('#destinationSelection').val("send");
        $('.slctLst').hide();

    }*/

}]);



//factory
//factory method to get values of destinations from json file
reservationModule.factory('hotelSelectionFactory',['$http','$q', function($http,$q){
    return {
        GetDestinations:function(){
            var deferred = $q.defer();
            $http({
              method: 'GET',
              url: '/etc/designs/reservation/destinationDropdownDetails/LocationNamesHotelNamesAirportNames.json'
            }).then(function successCallback(response) {
                localStorage.setItem('DestinationsOnline',JSON.stringify(response));
                deferred.resolve(response.data);
            }, function errorCallback(response) {
                console.log('ajax call failed to get Destinations for hotels reservation page.');
                deferred.reject(response.data);
            });
            return deferred.promise
        },
        getDropDownValues:function(){
                    var deferred = $q.defer();
                    $http({
                      method: 'GET',
                      url: '/itconline/components/content/reservationwidget',
					  params:
                        {
                            parentLocationPath:'/content/home/lchotels'
            			}
                    }).then(function successCallback(response) {

                        deferred.resolve(response.data);
                        //appendDropDownValues(response);
                    }, function errorCallback(response) {
                        console.log('ajax call failed to get dropdown values for hotels reservation page.');
                        deferred.reject(response.data);
                    });
                    return deferred.promise
                },
        getCheckedHotelsDetails:function(hotelPropertyMap){
                    var deferred = $q.defer();
                    $http({
                      method: 'POST',
                      url: '/itconline/components/content/comparehotels',
					  params:
                        {
                            hotelPropertyMap:hotelPropertyMap,
                            offlineHotelsPath:$("#offlineHotelsPath").attr("hotelsPath")
            			}
                    }).then(function successCallback(response) {

                        deferred.resolve(response.data);
                        //appendDropDownValues(response);
                    }, function errorCallback(response) {
                        console.log('ajax call failed to get dropdown values for hotels reservation page.');
                        deferred.reject(response.data);
                    });
                    return deferred.promise
                },




        appendDropDownValues:function(hotelDetailsList){

        $("#dynamicDropdownAppendRes").empty();

            var html='';
        	for(var index=0;index<hotelDetailsList.length;index++)
                 {
                     var category;
                     if(index==0)
                     {
                         category='Destination';
                         html=html+'<li class="hed headingIdentity" data-rel="Destination"><a href="javascript:;" style="pointer-events: none;">Destination</a></li>';
                     }
                     /*if(index==1)
                     {
                        category='Hotels';
                        html=html+'<li class="hed headingIdentity" data-rel="Hotels"><a href="javascript:;" style="pointer-events: none;">Hotels</a></li>';
                     }
                     if(index==2)
                     {
                        category='Airport Code';
                        html=html+'<li class="hed headingIdentity" data-rel="Airport Code"><a href="javascript:;" style="pointer-events: none;">Airport Code</a></li>';
                     }*/

					if(index==0)
                    {
                     $.each(hotelDetailsList[index], function (key, val)
                    {
                        html=html+'<li data-rel="'+key+'" class="" style="display: list-item;"><a href="javascript:;" id="identity'+key+'" onclick="putSelectedValue(\''+key+'\')" category="'+category+'">'+key+'</a></li>';
                    });
                    }



                 }

            $("#dynamicDropdownAppendRes").append(html);

        },

        GetHotelSearchResults:function(locationId,identity){
        var checkinDate;
                    var checkoutDate;
        			var adults;
                    var rooms;
                    var children;
                    var selectedDrodownValue;
                    var isThere=false;
                    var propertyList;
        if(identity=='onload')
        {
            checkinDate=localStorage.getItem("checkInDateRes");
            checkoutDate=localStorage.getItem("checkOutDateRes");
            adults=localStorage.getItem("numberOfAdults");
            rooms=localStorage.getItem("numberOfRooms");
            children="0";
                        propertyList=localStorage.getItem("propertyList");
                        sessionStorage.setItem("propertyList",propertyList);
            selectedDrodownValue=localStorage.getItem("Agra");


        }else{
            //function to fetch search results from your selection search block


            checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
            checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
			adults='';
            rooms='';
            children='';
            selectedDrodownValue=$("#destinationSelection").val();
            isThere=false;
            propertyList;

            if($('#reservationAdults').val()=='')
            {
                adults=1;
            }else{
				adults=$('#reservationAdults').val();
            }
            if($('#reservationRooms').val()=='')
            {
                rooms=1;
            }else{
				rooms=$('#reservationRooms').val();
            }
            if($('#reservationChildren').val()=='')
            {
                children=0;
            }else{
				children=$('#reservationChildren').val();
            }



			//var dropDownList=$scope.dropDownList;


            for(var index=0;index<dropDownList.length;index++)
			{

                if(isThere==false)
                {
		$.each(dropDownList[index], function (key, val)
               {
                   if(isThere==false)
                   {
					if(key==selectedDrodownValue)
                    {
                        for(var mapIndex=0;mapIndex<val.length;mapIndex++)
                        {

                            propertyList=JSON.stringify(val[mapIndex]);



                            isThere=true;


                            break;
                        }

                    }
                   }
                   else
                   {
                       return false;
                   }

               });
                }

        }

        }
        var deferred = $q.defer();


            var day=moment(checkinDate,'YYYY-MM-DD').format('dddd').toLowerCase();
            if(!(propertyList==undefined))
            {
            propertyList=JSON.stringify(propertyList);
            sessionStorage.setItem("propertyList",propertyList);
            propertyList=JSON.parse(propertyList);
            }
            else{
            propertyList=JSON.parse(localStorage.getItem("propertyList"));
            }
            $('.se-pre-con').show();

            $http({
              method: 'POST',
              url: '/itconline/getAllHotelSearchResults',
                dataType: 'JSON',
              params: {
                  checkInDt:checkinDate,
                  checkOutDt:checkoutDate,
                  noOfAdults:adults,
                  day:day,
                  noOfRooms:rooms,
                  noOfChildren:children,
                  propertyList:propertyList
            	}
            }).then(function successCallback(response) {
                localStorage.setItem('hotelSearchResults',JSON.stringify(response));
                deferred.resolve(response.data);
            }, function errorCallback(response) {
                console.log('ajax call failed to get Destinations for hotels reservation page.');
                deferred.reject(response.data);
            });
            return deferred.promise

        }

    }

}]);

// room selection Page

reservationModule.controller('roomSelectionController',['$location','$scope','hotelSelectionFactory','RoomSelectionFactory','commonDataSharingFactory',function($location,$scope,hotelSelectionFactory,RoomSelectionFactory,commonDataSharingFactory){
    $('#customizeYourStayPage').removeClass('act');
    $('#customizeYourStayPage1').removeClass('act');
    $('#personalDetailsPage').removeClass('act');
    $('#personalDetailsPage1').removeClass('act');
    $('#summaryPage').removeClass('act');
    $('#summaryPage1').removeClass('act');
    $('#roomRatesPage').addClass('act');
    $('#roomRatesPage1').addClass('act');

    // functions to make the dropdown work for promo code
        $('.itc_custom_input').keyup(function(e) {

        		var search = $.trim($(this).val());
        		$(this).parent().parent().find('.noresult').hide();
        		$(this).parent().parent().find('.autoSugg').show();


        		$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
        			if(!$(v).attr('data-rel')) {
        				$(v).attr('data-rel',$.trim($(v).find('a').text()));
        			}
        		});

        		if(search != '') {
        			search = search.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')
        			var filter = new RegExp("(.*)("+search+")(.*)", "ig");
        			var brk = null;
        			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
        				var datarel = $(v).attr('data-rel');
        				if(filter.test($.trim(datarel)) && brk== null) {
        					$(v).siblings().removeClass('drpAct');
        					$(v).addClass('drpAct');
        					$('.autoSuggCont').scrollTo('.drpAct');
        					brk = 1;
        					$(v).find('a').html(datarel.replace(filter,'$1<b>$2</b>$3'));
        				} else {
        					$(v).find('a').html(datarel);
        					$(v).removeClass('drpAct');
        				}
        			});
        			if(brk == null) {
        				$(this).parent().parent().find('.noresult').show();
        				$(this).parent().parent().find('.autoSugg').hide();
        				$(this).closest('.selcArp').removeClass('act');
        			}
        		} else {
        			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
        				if($(v).attr('data-rel')) {
        					$(v).find('a').html($(v).attr('data-rel'));
        				}
        				$(v).attr('data-rel',$.trim($(v).find('a').text()));
        			});

        			$(this).parent().parent().find('.autoSugg li').show();
        			$(this).parent().parent().find('.autoSugg li.drpAct').removeClass('drpAct');
        		}

        		if(e.keyCode == 13) {
        			var currLi =  $('.autoSugg:visible li.drpAct');
        			capLet(currLi);
        			$(currLi).closest('.autoSugg').hide();
        			$('.selcArp').removeClass('act');// supproting files
        		}

        		// down
        		if(e.keyCode == 40) {
        			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
        				if($(v).attr('data-rel')) {
        					$(v).find('a').html($(v).attr('data-rel'));
        				}
        				$(v).attr('data-rel',$.trim($(v).find('a').text()));
        			});
        			downArr();
        			return false;
        		}

        		//up
        		if(e.keyCode == 38) {
        			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
        				if($(v).attr('data-rel')) {
        					$(v).find('a').html($(v).attr('data-rel'));
        				}
        				$(v).attr('data-rel',$.trim($(v).find('a').text()));
        			});
        			upArr(this);
        			return false;
        		}

        		//delete
        		if(e.keyCode == 8) {
        			$(this).parent().find('.autoSugg').slideDown();
        			$('.selcArp').addClass('act');// supproting files
        			$(this).parent().find('.autoSugg').scrollTo('.drpAct');
        		}

        }).
        on("click", function(e) {
        	$(this).next().addClass('cls');
        	$('.autoSugg').hide();
        	$(this).parent().parent().find('.autoSugg').show();
        	$(this).parent().parent().find('.autoSugg').jScrollPane();
        	$(this).parent().parent().find('.noresult').hide();

        }).on("focus", function(e) {
        	$(this).next().addClass('cls');
        	$('.autoSugg').hide();
        	$(this).parent().parent().find('.autoSugg').show();
        	$(this).parent().parent().find('.autoSugg').jScrollPane();
        	$(this).parent().parent().find('.noresult').hide();

        });

        //function to add drpAct class on hovered option in dropdown
        $('.autoSugg li').hover(function() {
        	$('.autoSugg:visible li').removeClass('drpAct');
        	$(this).addClass('drpAct');
        });
        // function to set the selected promo type
        $scope.promo=function(promotype){
            $('#reservationPromocodeName').val(promotype);
            $('.slctnLst').hide();
            $('#promoTypeArrow').removeClass('cls');
        };
    //function for calender to work properly

	$("#resCheckIn").datepick({
        minDate: 0,
        rangeSelect: false,
        changeMonth: false,
        defaultDate: GL_checkInDate[0],
        selectDefaultDate: true,
        onSelect:function (d){
            $('.checkIn .day').text(monthNames[d[0].getMonth()]);
            $('.checkIn .date').text(d[0].getDate());
            $('.checkIn .year').text(d[0].getFullYear());

            $("#resCheckOut").datepick('option', {minDate:d[0]});
            $('.resCheckInWp').hide();
            $("#resCheckIn .dp"+d[0].getTime()).addClass("datepick-selected");

            var _n = new Date(d[0]);
            _n.setDate(d[0].getDate() + 1);
            $("#resCheckOut").datepick('setDate',_n);
        }
    });
    //$("#resCheckIn .dp"+GL_checkInDate[0].getTime()).addClass("datepick-selected");


    $("#resCheckOut").datepick({
        minDate: 0,
        rangeSelect: false,
        changeMonth: false,
        onDate: codates,
        onSelect:function (dates){
            $('.checkOut .day').text(monthNames[dates[0].getMonth()]);
            $('.checkOut .date').text(dates[0].getDate());
            $('.checkOut .year').text(dates[0].getFullYear());
            //$('#resCheckOut .datepick-selected').removeClass('datepick-selected');
            //$("#resCheckOut .dp"+GL_checkInDate[0].getTime()).addClass("datepick-selected");
            $('.resCheckInWp').hide();
        },
        onShow: $.datepick.hoverCallback(showHoverDays)
    });	//calender function end

    $("#promoError").empty();
    $scope.dropDownList=JSON.parse(commonDataSharingFactory.getDropdownValuesList())
	hotelSelectionFactory.GetDestinations().then(function(){
            $scope.destinationDropdownValues=JSON.parse(localStorage.getItem('DestinationsOnline'));
	});

    $(".rfnSrchWpr").attr("style","display:none;");
    //setting parameters of previous page
    	$('#destinationSelection').val(localStorage.getItem('destination'));
		$('#checkinDay').text(localStorage.getItem('checkinDay'));
        $('#checkinMonth').text(localStorage.getItem('checkinMonth'));
        $('#checkinYear').text(localStorage.getItem('checkinYear'));
        $('#checkoutDay').text(localStorage.getItem('checkOutDay'));
        $('#checkoutMonth').text(localStorage.getItem('checkOutMonth'));
        $('#checkoutYear').text(localStorage.getItem('checkOutYear'));
		$('#reservationAdults').val(localStorage.getItem('adults'));
    	$('#reservationRooms').val(localStorage.getItem('rooms'));
    	$('#reservationChildren').val(localStorage.getItem('children'));
    	var hotelId=localStorage.getItem('hotelId');
		var checkoutDate=localStorage.getItem('checkoutDate');
        var checkinDate=localStorage.getItem('checkinDate');
		var day=moment(checkinDate,'YYYY-MM-DD').format('dddd').toLowerCase();
    	$scope.hotelId=hotelId;
    //function to set location in input and fetch location id from dropdown
    $scope.capLet=function(location,locationId){
		var currVal = location;
        $scope.locationId=locationId;
        $scope.Location=location;
        $('#destinationSelection').val(currVal);
        $('.slctLst').hide();
    };

    $scope.getRoomSearchResultOnUpdate=function(){
    RoomSelectionFactory.GetRoomSearchResults('update').then(function(data){
    		$scope.roomDetails=data;
        });

    }

    RoomSelectionFactory.GetRoomSearchResults(hotelId,checkinDate,checkoutDate,localStorage.getItem('adults'),day).then(function(data){
		$scope.roomDetails=data;
    });

    //function to fetch search results from refine your search block on button click function
    //$scope.getHotelSearchResults=function(){
    //    hotelSelectionFactory.GetHotelSearchResults($scope.locationId).then(function(data){
			//$scope.hotelSearchResults=data;
	//		$scope.hotelSearchResults=JSON.parse(localStorage.getItem('hotelSearchResults'));

    //    });
    //}
    $scope.getPlanDetaisForRoomId=function(roomId,roomName){
		commonDataSharingFactory.setRoomName(roomName);
        commonDataSharingFactory.setRoomId(roomId);
        var checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
        var checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
        var day=moment(checkinDate,'YYYY-MM-DD').format('dddd').toLowerCase();
        RoomSelectionFactory.GetPlansForRoomSearchResults($scope.hotelId,checkinDate,checkoutDate,localStorage.getItem('adults'),day,roomId).then(function(data){
			$scope.PlanDetaisForRoomId=data;
        });
    }

    $scope.getPlansByHotel=function(){
        var checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
        var checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
        var day=moment(checkinDate,'YYYY-MM-DD').format('dddd').toLowerCase();
        var adults='';
        var rooms='';
        var children='';
        if($('#reservationAdultsSelection').val()=='')
        {
            adults=1;
        }else{
            adults=$('#reservationAdultsSelection').val();
        }
        if($('#reservationRooms').val()=='')
        {
            rooms=1;
        }else{
            rooms=$('#reservationRooms').val();
        }
        if($('#reservationChildren').val()=='')
        {
            children=0;
        }else{
            children=$('#reservationChildren').val();
        }
        RoomSelectionFactory.GetPlansByHotelId($scope.hotelId,checkinDate,checkoutDate,adults,day).then(function(data){
			$scope.planByHotel=data;
        });
    }

    $scope.GetRoomsByPlanId=function(planId,planDesc,ratePlanAmt){
        localStorage.setItem('planID',planId);
		commonDataSharingFactory.setGuestSelectedRatePlan(planDesc);
        commonDataSharingFactory.setTotalAmount(ratePlanAmt);
        var checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
        var checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
        var day=moment(checkinDate,'YYYY-MM-DD').format('dddd').toLowerCase();
        var adults='';
        var rooms='';
        var children='';
        if($('#reservationAdultsSelection').val()=='')
        {
            adults=1;
        }else{
            adults=$('#reservationAdultsSelection').val();
        }
        if($('#reservationRooms').val()=='')
        {
            rooms=1;
        }else{
            rooms=$('#reservationRooms').val();
        }
        if($('#reservationChildren').val()=='')
        {
            children=0;
        }else{
            children=$('#reservationChildren').val();
        }
        RoomSelectionFactory.GetRoomsByPlanId($scope.hotelId,checkinDate,checkoutDate,adults,day,planId).then(function(data){
			$scope.roomByPlan=data;

        });

    }


    $scope.redirectToCustomizeStay=function(hotelCategory,ratePlan,ratePlanAmt,hotelCode,chainCode,roomTypeCode,ratePlanCode,roomName,ratePlanPrice){
    if(hotelCategory=='offline')
    {
        localStorage.setItem("roomName",hotelCode);
               // commonDataSharingFactory.setTotalAmount(ratePlanPrice);
                commonDataSharingFactory.setRoomName(hotelCode);
               // commonDataSharingFactory.setGuestSelectedRatePlan(ratePlanName);
                localStorage.setItem("ratePlanName",ratePlan);
    }
    else{

        localStorage.setItem("roomName",roomName);
       // commonDataSharingFactory.setTotalAmount(ratePlanPrice);
        commonDataSharingFactory.setRoomName(roomName);
       // commonDataSharingFactory.setGuestSelectedRatePlan(ratePlanName);
        localStorage.setItem("ratePlanName",ratePlan);
        }
        commonDataSharingFactory.setRoomTypeCode(roomTypeCode);
        commonDataSharingFactory.setRatePlanCode(ratePlanCode);
        if($('#reservationAdultsSelection').val()=='')
        {
			commonDataSharingFactory.setNumberOfAdults('1');
        }
        else
        {
			commonDataSharingFactory.setNumberOfAdults($('#reservationAdultsSelection').val());
        }

        if($('#reservationChildrenSelection').val()=='')
        {
			commonDataSharingFactory.setNumberOfChildrens('0');
        }
        else
        {
			commonDataSharingFactory.setNumberOfChildrens($('#reservationChildrenSelection').val());
        }

        if($('#reservationRoomsSelection').val()=='')
        {
			commonDataSharingFactory.setNumberOfRooms('1');
        }
        else
        {
			commonDataSharingFactory.setNumberOfRooms($('#reservationChildrenSelection').val());
        }

        //commonDataSharingFactory.setNumberOfAdults($('#reservationAdultsSelection').val());
        //commonDataSharingFactory.setNumberOfChildrens($('#reservationChildrenSelection').val());
        //commonDataSharingFactory.setNumberOfRooms($('#reservationRoomsSelection').val());
        commonDataSharingFactory.setHotelCategory(hotelCategory);
        commonDataSharingFactory.setHotelCode(hotelCode);
        commonDataSharingFactory.setChainCode(chainCode);
		commonDataSharingFactory.setTotalAmount(ratePlanAmt);
		commonDataSharingFactory.setGuestSelectedRatePlan(ratePlan);

        $location.path('/customizeYourStay');
    }

    $scope.redirectToCustomizeStayForByRate=function(hotelCategory,roomName,roomId,hotelCode,chainCode,roomTypeCode,ratePlanCode,roomName,ratePlanName,ratePlanPrice){

             if(hotelCategory=='offline')
             {
             commonDataSharingFactory.setRoomName(roomName);

               localStorage.setItem("roomName",roomName);
                            localStorage.setItem("ratePlanName",hotelCode);
             }
             else
             {
             commonDataSharingFactory.setRoomName(roomName);
                localStorage.setItem("roomName",roomName);
                             localStorage.setItem("ratePlanName",ratePlanName);
             }
             commonDataSharingFactory.setRoomAmountPerNight(ratePlanPrice);
        //commonDataSharingFactory.setRoomName(roomName)
        commonDataSharingFactory.setGuestSelectedRatePlan(ratePlanName);
        commonDataSharingFactory.setRoomTypeCode(roomTypeCode);
        commonDataSharingFactory.setRatePlanCode(ratePlanCode);
        commonDataSharingFactory.setNumberOfAdults($('#reservationAdultsSelection').val());
        commonDataSharingFactory.setNumberOfChildrens($('#reservationChildrenSelection').val());
        commonDataSharingFactory.setNumberOfRooms($('#reservationRoomsSelection').val());
        commonDataSharingFactory.setHotelCategory(hotelCategory);
        commonDataSharingFactory.setHotelCode(hotelCode);
        commonDataSharingFactory.setChainCode(chainCode);
		commonDataSharingFactory.setRoomName(roomName);
        commonDataSharingFactory.setRoomId(roomId);
        commonDataSharingFactory.setTotalAmount(ratePlanPrice);
        $location.path('/customizeYourStay');
    }

    $('.plIc,.mnIc').click(function(e) {
        e.preventDefault();
        counting(this);
   	});

    function counting(arg) {
        var inpField = $(arg).closest('.rsrvDtailWp').find('.itc_custom_input');
        var tarEleLen;
        if( pageName == 'reservation') {
        // this section is only for reservation page
            // stting upper limit for room,adultand children
            if($(arg).closest('.slctn').hasClass('roomJs')) {
                tarEleLen = 9;
            } else {
                tarEleLen = 18;
            }

            var inpval = $(inpField).val();
            var labelTxt = $(arg).closest('.slctn').find('.hdng').html();
            var label = $(arg).closest('.slctn').find('.hdng');

            if($(arg).hasClass('plIc')) {
                // pluus icon
                if($(label).hasClass('act')) {
                }else {
                    if(labelTxt == 'Children') {
                    }else {
                        $(label).html(labelTxt+'s');
                        $(label).addClass('act');
                    }
                }
                $(arg).next().removeClass('inAct');
                if (inpval == '') {
                    inpval = 2;
                    $(inpField).val('2');
                }else {
                    if(inpval ==  tarEleLen) {return;}
                    inpval = Number(inpval);
                    inpval++;
                    $(inpField).val(inpval);
                    if(inpval ==  tarEleLen) { $(arg).addClass('inAct');}
                }
            }else {
                // minus icon
                if (inpval == '') {
                    return;
                }else {
                    if(inpval ==  '1') {  return;}
                    $(arg).prev().removeClass('inAct');
                    inpval = Number(inpval);
                    inpval--;
                    $(inpField).val(inpval);
                    if(inpval ==  '1') {
                        if(labelTxt == 'Children') {
                        }else {
                            labelTxt=labelTxt.slice(0,-1);
                            $(label).html(labelTxt);
                            $(label).removeClass('act');
                        }
                        $(arg).addClass('inAct');
                    }
                }
            }
        } else {
            // this section is only for rest of the  pages at present home and hotel level pages
            var tarEle = $(arg).closest('.rsrvDtailWp').find('.prmCDd li');
            var index =  $(arg).closest('.rsrvDtailWp').find('.prmCDd li.drpAct').index();
            tarEleLen = tarEle.length;
            var lastVal = $(tarEle[tarEleLen-1]).children().html();
            var firstVal = $(tarEle[0]).children().html();

            if($(arg).hasClass('plIc')) {
                console.log(index);
                if((index+1) ==  tarEleLen) { return; }
                $(arg).next().removeClass('inAct');
                var res =  $(tarEle[index+1]).children().html();
                $(inpField).val(res);
                $(tarEle).removeClass('drpAct');
                $(tarEle[index+1]).addClass('drpAct');
                if($(inpField).val() == lastVal) { $(arg).addClass('inAct');}
            } else {
                console.log(index);
                if((index) == 0) { return  };
                $(arg).prev().removeClass('inAct');
                var res =  $(tarEle[index-1]).children().html();
                $(inpField).val(res);
                $(tarEle).removeClass('drpAct');
                $(tarEle[index-1]).addClass('drpAct');
                if($(inpField).val() == firstVal) { $(arg).addClass('inAct');}
            }
        }


    }


}]);

// room selection factory

reservationModule.factory('RoomSelectionFactory',['$http','$q','commonDataSharingFactory','$location', function($http,$q,commonDataSharingFactory,$location){
    return {
        GetRoomSearchResults:function(hotelId,checkinDate,checkoutDate,adults,day){
            //function to fetch search results from your selection search block
            var roomCount;
            var childrenCount;
            var selectionType="";
            var propertyList;
            var promocodeName;
            var promocodeValue;
            var selectedCategory;

            if(hotelId=='update')
            {
                checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
                checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
                promocodeName=$("#reservationPromocodeName").val();
                promocodeValue=$("#reservationPromocodeValue").val();
                if($('#reservationRoomsSelection').val()=='')
                {
                    roomCount=1;
                }else{
                    roomCount=$('#reservationRoomsSelection').val();
                }
                if($('#reservationChildrenSelection').val()=='')
                {
                    childrenCount=0;
                }else{
                    childrenCount=$('#reservationChildrenSelection').val();
                }
                if($('#reservationAdultsSelection').val()=='')
                {
                    adults=1;
                }else{
                    adults=$('#reservationAdultsSelection').val();
                }
                selectionType='update';

                var selectedDrodownValue=$("#destinationSelection").val();
                var isThere=false;
                propertyList=commonDataSharingFactory.getDropdownValuesList();

                for(var index=0;index<dropDownList.length;index++)
                			{

                                if(isThere==false)
                                {
                		$.each(dropDownList[index], function (key, val)
                               {
                                   if(isThere==false)
                                   {
                					if(key==selectedDrodownValue)
                                    {
                                        if(index==0)
                                        {
                                            selectedCategory='location';
                                        }
                                        else if(index==1)
                                        {
                                            selectedCategory='hotel';
                                        }
                                        else if(index==2)
                                        {
                                            selectedCategory='airport';
                                        }
                                        for(var mapIndex=0;mapIndex<val.length;mapIndex++)
                                        {

                                            propertyList=JSON.stringify(val[mapIndex]);



                                            isThere=true;


                                            break;
                                        }

                                    }
                                   }
                                   else
                                   {
                                       return false;
                                   }

                               });
                                }

                        }


            }
            else
            {
            if($('#reservationRooms').val()=='')
            {
                roomCount=1;
            }else{
                roomCount=$('#reservationRooms').val();
            }
            if($('#reservationChildren').val()=='')
            {
                childrenCount=0;
            }else{
                childrenCount=$('#reservationChildren').val();
            }
            }





            var hotelCategory=commonDataSharingFactory.getHotelCategory();
            var chainCode=commonDataSharingFactory.getChainCode();
            var hotelCode=commonDataSharingFactory.getHotelCode();
            var isValidPromocode=true;
            var errorMessage='';
            sessionStorage.setItem("hotelCode",hotelCode);
            sessionStorage.setItem("chainCode",chainCode);
            var hotelPagePath=commonDataSharingFactory.getHotelPagePath();
            var isPromoRatePlan=commonDataSharingFactory.getIsPromoRatePlan();
            var currentTime=moment().format("THH:mm:SS");
            checkinDate=moment(checkinDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");
            checkoutDate=moment(checkoutDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");

            if(selectedCategory=='location'||selectedCategory=='airport')
            {
                //redirect
                var checkinDate=$('#checkinYear').text()+'-'+moment($('#checkinMonth').text(),'MMMM').format('MM')+'-'+$('#checkinDay').text();
                var checkoutDate=$('#checkoutYear').text()+'-'+moment($('#checkoutMonth').text(),'MMMM').format('MM')+'-'+$('#checkoutDay').text();
                localStorage.setItem('destination',$('#destinationSelection').val());
                localStorage.setItem('checkinDate',checkinDate);
                localStorage.setItem('checkoutDate',checkoutDate);
                localStorage.setItem('checkinDay',$('#checkinDay').text());
                localStorage.setItem('checkinMonth',$('#checkinMonth').text());
                localStorage.setItem('checkinYear',$('#checkinYear').text());
                localStorage.setItem('checkOutDay',$('#checkoutDay').text());
                localStorage.setItem('checkOutMonth',$('#checkoutMonth').text());
                localStorage.setItem('checkOutYear',$('#checkoutYear').text());
                var adults='';
                var rooms='';
                var children='';
                if($('#reservationAdultsSelection').val()=='')
                {
                    adults=1;
                }
                else
                {
                    adults=$('#reservationAdultsSelection').val();
                }
                if($('#reservationRoomsSelection').val()=='')
                {
                    rooms=1;
                }else{
                    rooms=$('#reservationRoomsSelection').val();
                }
                if($('#reservationChildrenSelection').val()=='')
                {
                    children=0;
                }else{
                    children=$('#reservationChildrenSelection').val();
                }
                localStorage.setItem('rooms',rooms);
                localStorage.setItem('adults',adults);
                localStorage.setItem('children',children);
                commonDataSharingFactory.setRoomRedirect(true);
                localStorage.setItem("propertyList",JSON.stringify(propertyList));
                $location.path('/');
            }

            else if(promocodeName!=undefined||promocodeValue!=undefined)
            {
                if(!((promocodeName=='')&&(promocodeValue=='')))
                {

                if(promocodeName=='None')
                {
                    promocodeName='';
                    if(promocodeValue.length>0)
                    {
                        isValidPromocode=false;
                        //$("#resPromoName").attr("class","bRed");
                        $("#promoError").empty();
                        $("#promoError").append('<div class="alrtIc"></div><p id="roomSelectionPromoErr">Please select Promo Code</p>');
                    }
                }
                else
                {
                if(!(promocodeName.length>0))
                {
                    isValidPromocode=false;
                    //$("#resPromoName").attr("class","bRed");
                    $("#promoError").empty();
                    $("#promoError").append('<div class="alrtIc"></div><p id="roomSelectionPromoErr">Please select Promo Code</p>');
                }
                else
                {
                    isValidPromocode=true;
                    //$("#promoError").empty();
                    //$("#resPromoName").attr("class","");
                    //$("#resPromoName").attr("class","slctnWpIn");
                }
                if(!(promocodeValue.length>0))
                                {
                                    isValidPromocode=false;
                                    $("#promoError").empty();
                                    //$("#resPromoValue").attr("class","bRed");
                                   $("#promoError").append('<div class="alrtIc"></div><p id="roomSelectionPromoErr">Please enter Promo Code value</p>');
                                }
                                else
                                {
                                    isValidPromocode=true;
                                    //$("#promoError").empty();
                                    //$("#resPromoName").attr("class","");
                                    //$("#resPromoName").attr("class","slctnWpIn");
                                }
                }

                }
                else
                {
                $("#promoError").empty();
                    isValidPromocode=true;
                }
            }
            else
            {
                $("#promoError").empty();
            }


            if(isValidPromocode==true)
            {
            if(hotelCategory=='offline')
            {
                $("#promoError").empty();
                var deferred = $q.defer();
                $http({
                  method: 'GET',
                  url: '/itconline/getMinRateRoomsByHotel',
                  params: {
                        promocodeName:promocodeName,
                        promocodeValue:promocodeValue,
                        selectionType:selectionType,
                        roomCount:roomCount,
                      childrenCount:childrenCount,
                      checkInDt:checkinDate,
                      checkOutDt:checkoutDate,
                      noOfAdults:adults,
                      availableDay:day,
                      arrivalDay:day,
                      hotelId:hotelId,
                      hotelCategory:hotelCategory,
                      propertyList:propertyList

                    }
                }).then(function successCallback(response) {
                    //localStorage.setItem('hotelSearchResults',JSON.stringify(response));
                    deferred.resolve(response.data);
                }, function errorCallback(response) {
                    console.log('ajax call failed to get Destinations for hotels reservation page.');
                    deferred.reject(response.data);
                });
                return deferred.promise
            }
            else if(hotelCategory=='online')
            {
                $("#promoError").empty();
                var deferred = $q.defer();
                $http({
                  method: 'GET',
                  url: '/itconline/getMinRateRoomsByHotel',
                  params: {
                  promocodeName:promocodeName,
                      promocodeValue:promocodeValue,
                      selectionType:selectionType,
                      hotelCategory:hotelCategory,
                      checkInDt:checkinDate,
                      checkOutDt:checkoutDate,
                      numberOfChildren:childrenCount,
                      noOfAdults:adults,
                      roomCount:roomCount,
                      availableDay:day,
                      arrivalDay:day,
                      chainCode:chainCode,
                      hotelCode:hotelCode,
                      hotelPagePath:hotelPagePath,
                      propertyList:propertyList
                    }
                }).then(function successCallback(response) {
                if(response.data.length<1)
                {
                    $("#promoError").append('<div class="alrtIc"></div><p id="roomSelectionPromoErr">Please enter correct Promo Code</p>');
                }
                    //localStorage.setItem('hotelSearchResults',JSON.stringify(response));
                    deferred.resolve(response.data);
                }, function errorCallback(response) {
                    console.log('ajax call failed to get Destinations for hotels reservation page.');
                    deferred.reject(response.data);
                });
                return deferred.promise

            }
            }
            else
            {
                return "invalid promocode";
            }
        },
        GetPlansForRoomSearchResults:function(hotelId,checkinDate,checkoutDate,adults,day,roomId){
            //function to fetch search results from your selection search block
			var deferred = $q.defer();
            $http({
              method: 'GET',
              url: '/itconline/getAllPlanRatesByRoom',
              params: {
                  checkInDt:checkinDate,
                  checkOutDt:checkoutDate,
                  noOfAdults:adults,
                  availableDay:day,
                  arrivalDay:day,
                  hotelId:hotelId,
                  roomId:roomId
            	}
            }).then(function successCallback(response) {
                //localStorage.setItem('hotelSearchResults',JSON.stringify(response));
                deferred.resolve(response.data);
            }, function errorCallback(response) {
                console.log('ajax call failed to get Destinations for hotels reservation page.');
                deferred.reject(response.data);
            });
            return deferred.promise
        },

        GetPlansByHotelId:function(hotelId,checkinDate,checkoutDate,adults,day){
			var deferred = $q.defer();
            $http({
              method: 'GET',
              url: '/itconline/getAllPlanRatesByHotel',
              params: {
                  checkInDt:checkinDate,
                  checkOutDt:checkoutDate,
                  noOfAdults:adults,
                  availableDay:day,
                  arrivalDay:day,
                  hotelId:hotelId

            	}
            }).then(function successCallback(response) {
                //localStorage.setItem('hotelSearchResults',JSON.stringify(response));
                deferred.resolve(response.data);
            }, function errorCallback(response) {
                console.log('ajax call failed to get Destinations for hotels reservation page.');
                deferred.reject(response.data);
            });
            return deferred.promise

    	},

        GetRoomsByPlanId:function(hotelId,checkinDate,checkoutDate,adults,day,planId){
			var deferred = $q.defer();
            $http({
              method: 'GET',
              url: '/itconline/getAllRoomsByPlan',
              params: {
                  checkInDt:checkinDate,
                  checkOutDt:checkoutDate,
                  noOfAdults:adults,
                  availableDay:day,
                  arrivalDay:day,
                  hotelId:hotelId,
                  planId:planId

            	}
            }).then(function successCallback(response) {
                //localStorage.setItem('hotelSearchResults',JSON.stringify(response));
                deferred.resolve(response.data);
            }, function errorCallback(response) {
                console.log('ajax call failed to get Destinations for hotels reservation page.');
                deferred.reject(response.data);
            });
            return deferred.promise
        }

    }

}]);



//personal details page

reservationModule.controller('personalDetailsPageController',['$location','$scope','personalDetailsPageFactory','commonDataSharingFactory',function($location,$scope,personalDetailsPageFactory,commonDataSharingFactory){
   //$scope.loggedInUserDetails=JSON.parse(personalDetailsPageFactory.getLoggedInUserDetails());
    $(".rfnSrchWpr").attr("style","display:none;");
    $('#roomRatesPage').removeClass('act');
    $('#roomRatesPage1').removeClass('act');
    $('#customizeYourStayPage').removeClass('act');
    $('#customizeYourStayPage1').removeClass('act');
    $('#summaryPage').removeClass('act');
    $('#summaryPage1').removeClass('act');
    $('#roomRatesPage').addClass('act');
    $('#roomRatesPage1').addClass('act');
    $('#customizeYourStayPage').addClass('act');
    $('#customizeYourStayPage1').addClass('act');
    $('#personalDetailsPage').addClass('act');
    $('#personalDetailsPage1').addClass('act');




    //functions to make dropdown work start
    $('.autoSugg').jScrollPane();

    populateAllCountries();

    function populateAllCountries(){
        $.each(place.getCountries(),function(i,item){
            $('.customAutoSuggCountries .jspContainer .jspPane').append('<li><a>'+item+'</a></li>');
        });
    }
    $('.customAutoSuggCountries').blur(function(){
        $('.personalDetails_state').val("");
        $('.customAutoSuggState li').remove();
        if($('.personalDetails_country').val() != ""){
            $('.personalDetails_mobStdCode').val(place.getCountryMobileCode($('.personalDetails_country').val()));
            if(place.getStates($('.personalDetails_country').val()) != 'empty'){
                    $.each(place.getStates($('.personalDetails_country').val()),function(i,item){
                                $('.customAutoSuggState .jspContainer .jspPane').append('<li><a>'+item+'</a></li>');
                    });
            }else{
                $('.customAutoSuggState li').remove();
                $('.personalDetails_state').val("");
                $('.personalDetails_city').val("");
            }
        }
    });

    $('.customAutoSuggState').blur(function(){
        $('.personalDetails_city').val("");
        $('.customAutoSuggCity li').remove();
        if($('.feedback_state').val() != ""){
            if(place.getCities($('.personalDetails_country').val(),$('.personalDetails_state').val()) != 'empty'){
                $.each(place.getCities($('.personalDetails_country').val(),$('.personalDetails_state').val()),function(i,item){
                            $('.customAutoSuggCity .jspContainer .jspPane').append('<li><a>'+item+'</a></li>');
                });
            }else{
                $('.customAutoSuggCity li').remove();
                $('.personalDetails_city').val("");
            }
        }
    });

    $('.itc_custom_input').keyup(function(e) {

    		var search = $.trim($(this).val());
    		$(this).parent().parent().find('.noresult').hide();
    		$(this).parent().parent().find('.autoSugg').show();


    		$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    			if(!$(v).attr('data-rel')) {
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			}
    		});

    		if(search != '') {
    			search = search.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')
    			var filter = new RegExp("(.*)("+search+")(.*)", "ig");
    			var brk = null;
    			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    				var datarel = $(v).attr('data-rel');
    				if(filter.test($.trim(datarel)) && brk== null) {
    					$(v).siblings().removeClass('drpAct');
    					$(v).addClass('drpAct');
    					$('.autoSuggCont').scrollTo('.drpAct');
    					brk = 1;
    					$(v).find('a').html(datarel.replace(filter,'$1<b>$2</b>$3'));
    				} else {
    					$(v).find('a').html(datarel);
    					$(v).removeClass('drpAct');
    				}
    			});
    			if(brk == null) {
    				$(this).parent().parent().find('.noresult').show();
    				$(this).parent().parent().find('.autoSugg').hide();
    				$(this).closest('.selcArp').removeClass('act');
    			}
    		} else {
    			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});

    			$(this).parent().parent().find('.autoSugg li').show();
    			$(this).parent().parent().find('.autoSugg li.drpAct').removeClass('drpAct');
    		}

    		if(e.keyCode == 13) {
    			var currLi =  $('.autoSugg:visible li.drpAct');
    			capLet(currLi);
    			$(currLi).closest('.autoSugg').hide();
    			$('.selcArp').removeClass('act');// supproting files
    		}

    		// down
    		if(e.keyCode == 40) {
    			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});
    			downArr();
    			return false;
    		}

    		//up
    		if(e.keyCode == 38) {
    			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});
    			upArr(this);
    			return false;
    		}

    		//delete
    		if(e.keyCode == 8) {
    			$(this).parent().find('.autoSugg').slideDown();
    			$('.selcArp').addClass('act');// supproting files
    			$(this).parent().find('.autoSugg').scrollTo('.drpAct');
    		}

    }).
    on("click", function(e) {
    	$(this).next().addClass('cls');
    	$('.autoSugg').hide();
    	$(this).parent().parent().find('.autoSugg').show();
    	$(this).parent().parent().find('.autoSugg').jScrollPane();
    	$(this).parent().parent().find('.noresult').hide();

    }).on("focus", function(e) {
    	$(this).next().addClass('cls');
    	$('.autoSugg').hide();
    	$(this).parent().parent().find('.autoSugg').show();
    	$(this).parent().parent().find('.autoSugg').jScrollPane();
    	$(this).parent().parent().find('.noresult').hide();
    });//functions to make drop down work end

    //for highlighting on hover
    $('.autoSugg li').hover(function() {
        $('.autoSugg:visible li').removeClass('drpAct');
        $(this).addClass('drpAct');
    });

    //function to set selected values
    $scope.capLet=function(arg) {
    		var currVal =  $('.autoSugg:visible li.drpAct a').text();
    		$(arg).closest('.autoSugg').parent().find('.itc_custom_input').val(currVal);
    	}
    $('.autoSugg li').click(function() {
    		var currVal = $(this).children('a').text();
    		$('.autoSugg:visible li').removeClass('drpAct');
    		$(this).addClass('drpAct');
    		$scope.capLet(this);
    		$(this).closest('.autoSugg').hide();
    		$('.blkDnIc').removeClass('cls');
    	});


    $scope.addThisAddOn=function(addOnName,amount)
        {
        //var myArray = new Object();
        //myArray["firstname"] = "Bob";
        //myArray["lastname"] = "Smith";
        //myArray["age"] = 25;
        //delete myArray["lastname"];
        if (addOnName in addOnMap) {
                                  //alert("there");
        // something
        } else {
         addOnMap[addOnName]=amount;
         var price=parseInt(commonDataSharingFactory.getTotalAmount());
                 price=price+amount;
                 $scope.totalAmount=price;
                 localStorage.setItem("totalAmount",price);
                 commonDataSharingFactory.setTotalAmount(price);
        // something else
        }
            /* var isThere=false;
            for(var index=0;index<addOnArr.length;index++)
            {
                if(addOnArr[index]==addOnName)
                {
                    isThere=true;
                }
            }
            if(isThere==false)
            {
                addOnArr.push(addOnName);
                $("#addOnCust").append('<li><p>'+addOnName+'</p><a href=\'javascript:;\' ng-click=\'removeThisAddOn('+addOnName+');">Remove</a></li>';
            }*/
            /*if(jQuery.inArray(addOnName, addOnArr) === -1)
            {
               addOnArr.push(addOnName);
               //$("#addOnCust").append('<li><p>'+addOnName+'</p><a href=\'javascript:;\' ng-click="removeThisAddOn('+addOnName+')">Remove</a></li>');
                //$("#addOnCust").append('<li><p>'+addOnName+'</p><a href="javascript:;" ng-click="removeThisAddOn(sss)">Remove</a></li>');
            }*/

            $scope.customizeAddOn=addOnMap;
        }

        $scope.removeThisAddOn=function(addOnName)
        {

            var amount1=addOnMap[addOnName];
            delete addOnMap[addOnName];
           amount1=parseInt(amount1);
            var price=parseInt(commonDataSharingFactory.getTotalAmount());
                    price=price-amount1;
                    $scope.totalAmount=price;
                    localStorage.setItem("totalAmount",price);
                    commonDataSharingFactory.setTotalAmount(price);
           /* var removeIndex=addOnArr.indexOf(addOnName);
            addOnArr.splice(removeIndex,1);

            //$_lis.hide();
            $_lis = $('#addOnCust li');

            $_lis.each( function(){
                            if( $(this).text().indexOf(addOnName) >= 0){
                                $(this).hide();
                            }
                *//*if( $(this).text().match(regExMatch) ) { $(this).show(); }*//*
            } );*/
        }
    $scope.customizeAddOn=addOnMap;
	if(getCookie('DG') )
    personalDetailsPageFactory.getLoggedInUserDetails().then(function(data){
            //user details mapped to scope variables
            $scope.userFirstName=data.FirstName;
            $scope.userTitle=data.Title;
            $scope.userLastName=data.LastName;
            $scope.userAddr1=data.AddressLine1;
            $scope.userAddr2=data.Address_Line2;
            $scope.userCountry=data.Country;
            $scope.userState=data.State;
            $scope.userCity=data.City;
            $scope.userCompanyName=data.CompanyName;
            $scope.userEmailId=data.EmailId;
            $scope.userMobileNumber=data.MobileNumber;
            $scope.userPincode=data.Pincode;
            $scope.userFacebookId=data.FacebookId;
            $scope.userInstagramId=data.InstagramId;
            $scope.userTwitterId=data.TwitterId;
        });





    $scope.hotelName=commonDataSharingFactory.getHotelName();
    $scope.checkinMonth=localStorage.getItem('checkinMonth');
    $scope.checkinDay=localStorage.getItem('checkinDay');
    $scope.checkinYear=localStorage.getItem('checkinYear');
    $scope.checkOutMonth=localStorage.getItem('checkOutMonth');
    $scope.checkOutDay=localStorage.getItem('checkOutDay');
    $scope.checkOutYear=localStorage.getItem('checkOutYear');
    $scope.roomName=commonDataSharingFactory.getRoomName();
    $scope.roomCount=localStorage.getItem('rooms');
    $scope.adultCount=localStorage.getItem('adults');
    $scope.childrenCount=localStorage.getItem('children');
    $scope.ratePlanName=commonDataSharingFactory.getGuestSelectedRatePlan();
    var a = moment([localStorage.getItem('checkOutYear'), 0, localStorage.getItem('checkOutDay')]);
    var b = moment([localStorage.getItem('checkinYear'), 0, localStorage.getItem('checkinDay')]);
    var days=a.diff(b, 'days');
    var singleRoomAmt=commonDataSharingFactory.getTotalAmount();
    var totalamount=Math.round(singleRoomAmt * days);
    if($scope.roomCount >1){
        totalamount=Math.round(totalamount * localStorage.getItem('rooms'));
    }
    $scope.totalAmount=totalamount;

    $scope.redirectToSummaryPage=function(){
        $('.errorCont1').empty();
        $scope.personalDetailsPageValidation=false;
        if($scope.userTitle=='undefined' || $scope.userTitle=='' || $scope.userTitle==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Select a Title.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            $scope.personalDetailsPageValidation=true;
        }
        if($scope.userFirstName=='undefined' || $scope.userFirstName=='' || $scope.userFirstName==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Enter First Name.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^[a-zA-Z\s]+$/.test($scope.userFirstName))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>First Name should contain only Alphabets.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }

        }
        if($scope.userLastName=='undefined' || $scope.userLastName=='' || $scope.userLastName==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Enter Last Name.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^[a-zA-Z\s]+$/.test($scope.userLastName))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Last Name should contain only Alphabets.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }
        }
        if($scope.userAddr1=='undefined' || $scope.userAddr1=='' || $scope.userAddr1==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Enter Address Line 1.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            $scope.personalDetailsPageValidation=true;
        }
        if($scope.userCountry=='undefined' || $scope.userCountry=='' || $scope.userCountry==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Select a Country.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^[a-zA-Z\s]+$/.test($scope.userCountry))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Country should contain only Alphabets.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }
        }
        if($scope.userState=='undefined' || $scope.userState=='' || $scope.userState==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Select a State.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^[a-zA-Z\s]+$/.test($scope.userState))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>State should contain only Alphabets.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }
        }
        if($scope.userCity=='undefined' || $scope.userCity=='' ||$scope.userCity==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Select a City.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^[a-zA-Z\s]+$/.test($scope.userCity))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>City should contain only Alphabets.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }
        }
        if($scope.userPincode=='undefined' || $scope.userPincode=='' || $scope.userPincode==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Enter Pincode.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^(0-9)?\d{6}$|(0-9)?\d{7}$|(0-9)?\d{8}$|(0-9)?\d{9}$|(0-9)?\d{10}$/.test($scope.userPincode))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please enter a valid Pincode.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }
        }
        if($scope.userEmailId=='undefined' || $scope.userEmailId=='' || $scope.userEmailId==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Enter Email Address.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
            if(! (/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test($scope.userEmailId))){
                $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please enter a valid Email ID.</p></div>');
                $scope.personalDetailsPageValidation=false;
            }else{
                $scope.personalDetailsPageValidation=true;
            }
        }
        if($scope.userMobileNumber=='undefined' || $scope.userMobileNumber=='' || $scope.userMobileNumber==null){
            $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please Enter Mobile Number.</p></div>');
            $scope.personalDetailsPageValidation=false;
        }else{
           if((!(/^(0-9)?\d{10}$/.test($scope.userMobileNumber)))&&($scope.userCountry=='India')){
               $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please enter a valid Mobile Number.</p></div>');
               $scope.personalDetailsPageValidation=false;
           }else if((!(/^(0-9)?\d{10}$|(0-9)?\d{11}$|(0-9)?\d{12}$|(0-9)?\d{13}$|(0-9)?\d{14}$|(0-9)?\d{15}$/.test($scope.userMobileNumber)))&&($scope.userCountry!='India')){
               $('.errorCont1').append('<div class="errwp"><div class="alrtIc"></div><p>Please enter a valid Mobile Number.</p></div>');
               $scope.personalDetailsPageValidation=false;
           }else{
               $scope.personalDetailsPageValidation=true;
           }
        }
        if($scope.personalDetailsPageValidation){
            commonDataSharingFactory.setGuestNameTitle($scope.userTitle);
            commonDataSharingFactory.setGuestLastName($scope.userLastName)
            commonDataSharingFactory.setGuestFirstName($scope.userFirstName);
            commonDataSharingFactory.setGuestAddressLine1($scope.userAddr1);
            commonDataSharingFactory.setGuestAddressLine2($scope.userAddr2);
            commonDataSharingFactory.setGuestCountry($scope.userCountry);
            commonDataSharingFactory.setGuestState($scope.userState);
            commonDataSharingFactory.setGuestCity($scope.userCity);
            commonDataSharingFactory.setGuestPincode($scope.userPincode);
            commonDataSharingFactory.setGuestEmailAddress($scope.userEmailId);
            commonDataSharingFactory.setGuestPhoneNumber($scope.userMobStdCode + $scope.userMobileNumber);
            var a = moment([localStorage.getItem('checkOutYear'), 0, localStorage.getItem('checkOutDay')]);
            var b = moment([localStorage.getItem('checkinYear'), 0, localStorage.getItem('checkinDay')]);
            var days=a.diff(b, 'days');
            var singleRoomAmt=commonDataSharingFactory.getTotalAmount();
            var totalamount=Math.round(singleRoomAmt * days);
            var registerCheckbox=false;
            if($scope.PersonalDetailsCreateAcount){
            var passwordValidation=false;
            $('.errorCont2').empty();
            if($scope.personalDetailsPassword != undefined || $scope.personalDetailsPassword != undefined){
                if(! (/^.*(?=.{8,})(?=.*\d)(?=.*[a-zA-Z])|(?=.{8,})(?=.*\d)(?=.*[!@#$%^&])|(?=.{8,})(?=.*[a-zA-Z])(?=.*[!@#$%^&]).*$/.test($.trim($scope.personalDetailsPassword)))){
                    $('.errorCont2').append('<div class="errwp"><div class="alrtIc"></div><p>Password should consist of Lower case or Upper case alphabets or a combination of both, At-least a number,a special character and min of 8 characters.</p></div>');
                    passwordValidation=false;
                }else{
                    passwordValidation=true;
                }
                if(($.trim($scope.personalDetailsRePassword) != $.trim($scope.personalDetailsPassword)) && ((/^.*(?=.{8,})(?=.*\d)(?=.*[a-zA-Z])|(?=.{8,})(?=.*\d)(?=.*[!@#$%^&])|(?=.{8,})(?=.*[a-zA-Z])(?=.*[!@#$%^&]).*$/.test($.trim($scope.personalDetailsPassword)))) ){
                    $('.errorCont2').append('<div class="errwp"><div class="alrtIc"></div><p>Password and repeat-password doesnot match.</p></div>');
                    passwordValidation=false;
                }else{
                    passwordValidation=true;
                }
            }else{
                $('.errorCont2').append('<div class="errwp"><div class="alrtIc"></div><p>Password cannot be blank.</p></div>');
                passwordValidation=false;
            }
               if(passwordValidation){
                    personalDetailsPageFactory.createUserFromReservationPage($scope.userEmailId,$scope.userTitle,$scope.userFirstName,$scope.userLastName,$scope.userAddr1,$scope.userAddr2,$scope.userCountry,$scope.userState,$scope.userCity,$scope.userPincode,$scope.userCompanyName,$scope.userMobStdCode,$scope.userMobileNumber,$scope.userFacebookId,$scope.userTwitterId,$scope.userInstagramId,$scope.personalDetailsPassword,$scope.personalDetailsRePassword).then(function(data){
                        $('.errorCont2').empty();
                        if(data=="user with email ID "+$scope.userEmailId+" and mobile number "+$scope.userMobileNumber+" already exists"){
                            $('.errorCont2').append('<div class="errwp"><div class="alrtIc"></div><p>user with email ID '+$scope.userEmailId+' and mobile number '+$scope.userMobileNumber+' already exists.</p></div>');
                        }
                        else if(data=="user with email ID "+$scope.userEmailId+" already exists"){
                            $('.errorCont2').append('<div class="errwp"><div class="alrtIc"></div><p>user with email ID '+$scope.userEmailId+' already exists.</p></div>');
                        }
                        else if(data=="user with Mobile Number "+$scope.userMobileNumber+" already exists"){
                            $('.errorCont2').append('<div class="errwp"><div class="alrtIc"></div><p>user with mobile number '+$scope.userMobileNumber+' already exists.</p></div>');
                        }else{
                            personalDetailsPageFactory.saveDataToDb($scope.hotelName,commonDataSharingFactory.getHotelAddress1(),"empty",commonDataSharingFactory.getHotelPhone(),commonDataSharingFactory.getHotelId(),commonDataSharingFactory.getRoomId(),commonDataSharingFactory.getRoomName(),localStorage.getItem('planID'),commonDataSharingFactory.getGuestSelectedRatePlan(),localStorage.getItem('checkinDate'),localStorage.getItem('checkoutDate'),days,localStorage.getItem('rooms'),localStorage.getItem('adults'),localStorage.getItem('children'),$scope.userTitle,$scope.userFirstName,$scope.userLastName,$scope.userAddr1,$scope.userAddr2,$scope.userEmailId,$scope.userMobileNumber,totalamount,$scope.userCity,$scope.userState,$scope.userCountry,$scope.userPincode).then(function(){
                                $location.path('/reviewAndPay');
                            });
                        }
                    });
               }

            }else{
                personalDetailsPageFactory.saveDataToDb($scope.hotelName,commonDataSharingFactory.getHotelAddress1(),"empty",commonDataSharingFactory.getHotelPhone(),commonDataSharingFactory.getHotelId(),commonDataSharingFactory.getRoomId(),commonDataSharingFactory.getRoomName(),localStorage.getItem('planID'),commonDataSharingFactory.getGuestSelectedRatePlan(),localStorage.getItem('checkinDate'),localStorage.getItem('checkoutDate'),days,localStorage.getItem('rooms'),localStorage.getItem('adults'),localStorage.getItem('children'),$scope.userTitle,$scope.userFirstName,$scope.userLastName,$scope.userAddr1,$scope.userAddr2,$scope.userEmailId,$scope.userMobileNumber,totalamount,$scope.userCity,$scope.userState,$scope.userCountry,$scope.userPincode).then(function(){
                    $location.path('/reviewAndPay');
                });
            }

        }
    }



}]);

//factory
reservationModule.factory('personalDetailsPageFactory',['$http','$q','commonDataSharingFactory', function($http,$q,commonDataSharingFactory){
return {



    getLoggedInUserDetails:function(){
        var deferred = $q.defer();
		var cookieToken =getCookie('DG');
        $http({
          method: 'POST',
          url: '/itconline/getLoggedInUserDetails',
            params: {
                cookieToken : cookieToken
            }

        }).then(function successCallback(response) {
			//console.log(JSON.stringify(response.data));
            //return response.data;
            deferred.resolve(response.data);
        }, function errorCallback(response) {
            console.log('ajax call failed to get Destinations for hotels reservation page.');
            deferred.reject(response.data);
        });
        return deferred.promise
    },
    saveDataToDb:function(hotelName,hotelAddress1,hotelAddress2,hotelContact,hotelId,roomId,roomName,planId,planName,checkinDate,checkoutDate,durationOfStay,numberOfRooms,numberOfAdults,numberOfChildrens,guestTitle,guestFirstName,guestLastName,guestAddress1,guestAddress2,guestEmailId,guestPhoneNumber,totalAmount,city,state,country,postalCode){
            var deferred = $q.defer();
            //var city=$scope.userCity;
            //var state=$scope.userState;
            //var country=$scope.userCountry;
            //var countryCode=getCounryCode(country);
            //var chainCode=commonDataSharingFactory.getChainCode();
            var chainCode=commonDataSharingFactory.getChainCode();
            var hotelCode=commonDataSharingFactory.getHotelCode();
            var checkoutDate=localStorage.getItem('checkoutDate');
            var checkinDate=localStorage.getItem('checkinDate');
            //var postalCode=$scope.userPincode;
            var roomTypeCode=commonDataSharingFactory.getRoomTypeCode();
            var ratePlanCode=commonDataSharingFactory.getRatePlanCode();
        	var currentTime=moment().format("THH:mm:SS");
            checkinDate=moment(checkinDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");
            checkoutDate=moment(checkoutDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");

            var tid=localStorage.getItem('tid');
            //alert('inside function');
                $http({
                      method: 'POST',
                      url: '/itconline/saveReservationData',
                        params: {
                            chainCode:chainCode,
                            hotelCode:hotelCode,
                            tid:tid,
                            city:city,
                            formType:'insert',
                            state:state,
                            country:country,
                            postalCode:postalCode,
                            hotelType:commonDataSharingFactory.getHotelCategory(),
                            hotelName:hotelName,
                            hotelAddress1:hotelAddress1,
                            hotelAddress2:hotelAddress2,
                            hotelContact:hotelContact,
                            hotelId:hotelId,
                            roomId:roomId,
                            roomName:roomName,
                            planId:planId,
                            planName:planName,
                            checkinDate:checkinDate,
                            checkoutDate:checkoutDate,
                            durationOfStay:durationOfStay,
                            numberOfRooms:numberOfRooms,
                            numberOfAdults:numberOfAdults,
                            numberOfChildrens:numberOfChildrens,
                            guestTitle:guestTitle,
                            guestFirstName:guestFirstName,
                            guestLastName:guestLastName,
                            guestAddress1:guestAddress1,
                            guestAddress2:guestAddress2,
                            guestPhoneNumber:guestPhoneNumber,
                            guestEmailId:guestEmailId,
                            totalAmount:totalAmount,
                            ratePlanCode:ratePlanCode,
                            roomTypeCode:roomTypeCode
                        }

                    }).then(function successCallback(response) {
                        //console.log(JSON.stringify(response.data));
                        //return response.data;
                        //var data=response.data;
                        //$window.location.href=data=response.data;
                        if(response.data>0){
                            sessionStorage.setItem("bid",response.data)
                            console.log('data saved to DB successfully');
                        }


                        deferred.resolve(response.data);
                    }, function errorCallback(response) {
                        console.log('ajax call failed');
                        deferred.reject(response.data);
                });
            return deferred.promise
        },
        createUserFromReservationPage:function(email,nameTitle,firstName,lastName,address1,address2,country,state,city,pincode,companyName,mobCode,mobNumber,facebook,twitter,instagram,password,retypePassword){
                var deferred = $q.defer();
        		var cookieToken =getCookie('DG');
                $http({
                  method: 'POST',
                  url: '/itconline/registerform',
                    params: {
                        loginId : email,
                        nameTitle : nameTitle,
                        firstName : firstName,
                        lastName : lastName,
                        gender : "",
                        address1 : address1,
                        address2 : address2,
                        country : country,
                        state : state,
                        city : city,
                        pincode : pincode,
                        companyName : companyName,
                        email : email,
                        mobCode : mobCode,
                        mobNumber : mobNumber,
                        facebook : facebook,
                        twitter : twitter,
                        instagram : instagram,
                        password : password,
                        retypePassword : retypePassword,
                        registerType : "PersonalDetailsReservationForm"
                    }

                }).then(function successCallback(response) {
        			//console.log(JSON.stringify(response.data));
                    //return response.data;

                    deferred.resolve(response.data);
                }, function errorCallback(response) {
                    console.log('ajax call failed to get Destinations for hotels reservation page.');
                    deferred.reject(response.data);
                });
                return deferred.promise
            }

   }
}]);




//customize your stay controller
reservationModule.controller('customizeYourStayController',['$scope','commonDataSharingFactory','customizeYourStayFactory',function($scope,commonDataSharingFactory,customizeYourStayFactory){
$(".rfnSrchWpr").attr("style","display:none;");
    $('#roomRatesPage').removeClass('act');
    $('#roomRatesPage1').removeClass('act');
    $('#personalDetailsPage').removeClass('act');
    $('#personalDetailsPage1').removeClass('act');
    $('#summaryPage').removeClass('act');
    $('#summaryPage1').removeClass('act');
    $('#roomRatesPage').addClass('act');
    $('#roomRatesPage1').addClass('act');
    $('#customizeYourStayPage').addClass('act');
    $('#customizeYourStayPage1').addClass('act');






    var hotelCategory=commonDataSharingFactory.getHotelCategory();
    if(hotelCategory=='online')
    {
        customizeYourStayFactory.getCustomizeYourStayData().then(function(data){
                    $scope.customizeStayData=data;
        	});
        	var reservationInternetTabHtml=$("#resInternetTab").html();
        	var reservationSpaTabHtml=$("#resSpaTab").html();
        	var reservationDiningTabHtml=$("#resDiningTab").html();

				if(reservationInternetTabHtml!=undefined)
                {
        	if(reservationInternetTabHtml.length<1)
        	{
        	    $("#resInternetHeading").attr("style","display:none");
        	}
                }

        if(reservationSpaTabHtml!=undefined)
                {
        	if(reservationSpaTabHtml.length<1)
            {
                $("#resSpaHeading").attr("style","display:none");
            }
                }

        if(reservationDiningTabHtml!=undefined)
                {
            if(reservationDiningTabHtml.length<1)
            {
               $("#resDiningHeading").attr("style","display:none");
            }
                }
                }else
                 {
                     commonDataSharingFactory.setHotelCategory("offline");
                 }
     //function to make drop downs work end
    $('.itc_custom_input').keyup(function(e) {

    		var search = $.trim($(this).val());
    		$(this).parent().parent().find('.noresult').hide();
    		$(this).parent().parent().find('.autoSugg').show();


    		$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    			if(!$(v).attr('data-rel')) {
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			}
    		});

    		if(search != '') {
    			search = search.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')
    			var filter = new RegExp("(.*)("+search+")(.*)", "ig");
    			var brk = null;
    			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    				var datarel = $(v).attr('data-rel');
    				if(filter.test($.trim(datarel)) && brk== null) {
    					$(v).siblings().removeClass('drpAct');
    					$(v).addClass('drpAct');
    					$('.autoSuggCont').scrollTo('.drpAct');
    					brk = 1;
    					$(v).find('a').html(datarel.replace(filter,'$1<b>$2</b>$3'));
    				} else {
    					$(v).find('a').html(datarel);
    					$(v).removeClass('drpAct');
    				}
    			});
    			if(brk == null) {
    				$(this).parent().parent().find('.noresult').show();
    				$(this).parent().parent().find('.autoSugg').hide();
    				$(this).closest('.selcArp').removeClass('act');
    			}
    		} else {
    			$.each($(this).parent().parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});

    			$(this).parent().parent().find('.autoSugg li').show();
    			$(this).parent().parent().find('.autoSugg li.drpAct').removeClass('drpAct');
    		}

    		if(e.keyCode == 13) {
    			var currLi =  $('.autoSugg:visible li.drpAct');
    			capLet(currLi);
    			$(currLi).closest('.autoSugg').hide();
    			$('.selcArp').removeClass('act');// supproting files
    		}

    		// down
    		if(e.keyCode == 40) {
    			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});
    			downArr();
    			return false;
    		}

    		//up
    		if(e.keyCode == 38) {
    			$.each($(this).parent().find('.autoSugg li'), function(i,v) {
    				if($(v).attr('data-rel')) {
    					$(v).find('a').html($(v).attr('data-rel'));
    				}
    				$(v).attr('data-rel',$.trim($(v).find('a').text()));
    			});
    			upArr(this);
    			return false;
    		}

    		//delete
    		if(e.keyCode == 8) {
    			$(this).parent().find('.autoSugg').slideDown();
    			$('.selcArp').addClass('act');// supproting files
    			$(this).parent().find('.autoSugg').scrollTo('.drpAct');
    		}

    }).
    on("click", function(e) {
    	$(this).next().addClass('cls');
    	$('.autoSugg').hide();
    	$(this).parent().parent().find('.autoSugg').show();
    	$(this).parent().parent().find('.autoSugg').jScrollPane();
    	$(this).parent().parent().find('.noresult').hide();

    }).on("focus", function(e) {
    	$(this).next().addClass('cls');
    	$('.autoSugg').hide();
    	$(this).parent().parent().find('.autoSugg').show();
    	$(this).parent().parent().find('.autoSugg').jScrollPane();
    	$(this).parent().parent().find('.noresult').hide();
    });//function to make drop downs work end
    $scope.hotelName=commonDataSharingFactory.getHotelName();
    $scope.checkinMonth=localStorage.getItem('checkinMonth');
    $scope.checkinDay=localStorage.getItem('checkinDay');
    $scope.checkinYear=localStorage.getItem('checkinYear');
    $scope.checkOutMonth=localStorage.getItem('checkOutMonth');
    $scope.checkOutDay=localStorage.getItem('checkOutDay');
    $scope.checkOutYear=localStorage.getItem('checkOutYear');
    $scope.roomName=commonDataSharingFactory.getRoomName();
    $scope.roomCount=localStorage.getItem('rooms');
    $scope.adultCount=localStorage.getItem('adults');
    $scope.childrenCount=localStorage.getItem('children');
	$scope.ratePlanName=commonDataSharingFactory.getGuestSelectedRatePlan();
	var a = moment([localStorage.getItem('checkOutYear'), 0, localStorage.getItem('checkOutDay')]);
    var b = moment([localStorage.getItem('checkinYear'), 0, localStorage.getItem('checkinDay')]);
    var days=a.diff(b, 'days');
    var singleRoomAmt=commonDataSharingFactory.getTotalAmount();
	var totalamount=Math.round(singleRoomAmt * days);
    if($scope.roomCount >1){
					totalamount=Math.round(totalamount * localStorage.getItem('rooms'));
            }
    $scope.totalAmount=totalamount;
    localStorage.setItem('totalAmount',totalamount);

    $scope.arrivalFlightNumber='';
    $scope.arrivalTimeHr='';
    $scope.arrivalTimeMin='';
    $scope.arrivalAirportName='';
    $scope.departureFlightNumber='';
    $scope.departureTimeHr='';
    $scope.departureTimeMin='';
    $scope.departureAirportName='';



    $scope.SetAirportArrivalDateAndTime=function(){
        commonDataSharingFactory.setAirportArrivalDetails($scope.arrivalFlightNumber,$scope.arrivalTimeHr,$scope.arrivalTimeMin,$scope.arrivalAirportName);
        $scope.addThisAddOn("Airport Transfer",0);
    }
    $scope.SetAirportDepartureDateAndTime=function(dateTimeOfArrival){

		commonDataSharingFactory.setAirportDepartureDetails($scope.departureFlightNumber,$scope.departureTimeHr,$scope.departureTimeMin,$scope.departureAirportName);
        $scope.addThisAddOn("Airport Transfer",0);
    }


    $scope.addThisAddOn=function(addOnName,amount)
    {
    //var myArray = new Object();
    //myArray["firstname"] = "Bob";
    //myArray["lastname"] = "Smith";
    //myArray["age"] = 25;
    //delete myArray["lastname"];
    if (addOnName in addOnMap) {
                             //alert("isThere");    //alert("there");
                    // something
                 } else {
                     addOnMap[addOnName]=amount;
                     var price=parseInt(commonDataSharingFactory.getTotalAmount());
                     var price=parseInt(commonDataSharingFactory.getTotalAmount());
                             price=price+amount;
                             $scope.totalAmount=price;
                             localStorage.setItem("totalAmount",price);
                             commonDataSharingFactory.setTotalAmount(price);
                    // something else
                 }
        /* var isThere=false;
        for(var index=0;index<addOnArr.length;index++)
        {
            if(addOnArr[index]==addOnName)
            {
                isThere=true;
            }
        }
        if(isThere==false)
        {
            addOnArr.push(addOnName);
            $("#addOnCust").append('<li><p>'+addOnName+'</p><a href=\'javascript:;\' ng-click=\'removeThisAddOn('+addOnName+');">Remove</a></li>';
        }*/
        /*if(jQuery.inArray(addOnName, addOnArr) === -1)
        {
           addOnArr.push(addOnName);
           //$("#addOnCust").append('<li><p>'+addOnName+'</p><a href=\'javascript:;\' ng-click="removeThisAddOn('+addOnName+')">Remove</a></li>');
            //$("#addOnCust").append('<li><p>'+addOnName+'</p><a href="javascript:;" ng-click="removeThisAddOn(sss)">Remove</a></li>');
        }*/

        $scope.customizeAddOn=addOnMap;
    }

    $scope.removeThisAddOn=function(addOnName)
    {

        var amount1=addOnMap[addOnName];
        delete addOnMap[addOnName];
       amount1=parseInt(amount1);
        var price=parseInt(commonDataSharingFactory.getTotalAmount());
                price=price-amount1;
                $scope.totalAmount=price;
                localStorage.setItem("totalAmount",price);
                commonDataSharingFactory.setTotalAmount(price);
       /* var removeIndex=addOnArr.indexOf(addOnName);
        addOnArr.splice(removeIndex,1);

        //$_lis.hide();
        $_lis = $('#addOnCust li');

        $_lis.each( function(){
                        if( $(this).text().indexOf(addOnName) >= 0){
                            $(this).hide();
                        }
            *//*if( $(this).text().match(regExMatch) ) { $(this).show(); }*//*
        } );*/
    }


}]);


reservationModule.factory('customizeYourStayFactory',['$http','$q','$window','commonDataSharingFactory', function($http,$q,$window,commonDataSharingFactory){
return {
    getCustomizeYourStayData:function(){
        var deferred = $q.defer();
        var currentTime=moment().format("THH:mm:SS");
        var checkoutDate=localStorage.getItem('checkoutDate');
        var checkinDate=localStorage.getItem('checkinDate');
          checkinDate=moment(checkinDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");
           checkoutDate=moment(checkoutDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");

        //localStorage.setItem('tid',tid);
        //alert('inside function');
            $http({
                  method: 'POST',
                  url: '/itconline/getAllAddOnPackages',
                    params:
                    {
                        checkinDate:checkinDate,
                        checkoutDate:checkoutDate,
                        hotelCategory:commonDataSharingFactory.getHotelCategory(),
                        hotelCode:commonDataSharingFactory.getHotelCode(),
                        chainCode:commonDataSharingFactory.getChainCode(),
                        numberOfAdults:commonDataSharingFactory.getNumberOfAdults(),
                        numberOfChildrens:commonDataSharingFactory.getNumberOfChildrens(),
                        numberOfRooms:commonDataSharingFactory.getNumberOfRooms()

                    }

                }).then(function successCallback(response) {

                    deferred.resolve(response.data);
                }, function errorCallback(response) {
                    console.log('ajax call failed to get Destinations for hotels reservation page.');
                    deferred.reject(response.data);
            });
        return deferred.promise
    }

   }
}]);

    //review And Pay controller
reservationModule.controller('reviewAndPayController',['$scope','commonDataSharingFactory','reviewAndPayFactory',function($scope,commonDataSharingFactory,reviewAndPayFactory){
$(".rfnSrchWpr").attr("style","display:none;");

    $('#roomRatesPage').removeClass('act');
    $('#roomRatesPage1').removeClass('act');
    $('#customizeYourStayPage').removeClass('act');
    $('#customizeYourStayPage1').removeClass('act');
    $('#personalDetailsPage').removeClass('act');
    $('#personalDetailsPage1').removeClass('act');
    $('#roomRatesPage').addClass('act');
    $('#roomRatesPage1').addClass('act');
    $('#customizeYourStayPage').addClass('act');
    $('#customizeYourStayPage1').addClass('act');
    $('#personalDetailsPage').addClass('act');
    $('#personalDetailsPage1').addClass('act');
    $('#summaryPage').addClass('act');
    $('#summaryPage1').addClass('act');
    //alert('inside review and pay');
    $scope.customizeAddOn=addOnMap;
    $scope.termsCheckbox;
    $scope.cancellationCheckbox;
    $scope.hotelName=commonDataSharingFactory.getHotelName();
    $scope.hotelAddress1=commonDataSharingFactory.getHotelAddress1();
    $scope.hotelAddress2=commonDataSharingFactory.getHotelAddress1();
    $scope.hotelTelephone=commonDataSharingFactory.getHotelPhone();
    $scope.hotelEmail=commonDataSharingFactory.getHotelEmail();
    //$scope.hotelName="test";
    //$scope.hotelAddress1="test";
    //$scope.hotelAddress2="test";
    //$scope.hotelTelephone="test";
    //$scope.hotelEmail="test";
    $scope.checkinMonth=localStorage.getItem('checkinMonth');
    $scope.checkinDay=localStorage.getItem('checkinDay');
    $scope.checkinYear=localStorage.getItem('checkinYear');
    $scope.checkOutMonth=localStorage.getItem('checkOutMonth');
    $scope.checkOutDay=localStorage.getItem('checkOutDay');
    $scope.checkOutYear=localStorage.getItem('checkOutYear');
    $scope.roomName=commonDataSharingFactory.getRoomName();
    $scope.roomCount=localStorage.getItem('rooms');
    $scope.adultCount=localStorage.getItem('adults');
    $scope.childrenCount=localStorage.getItem('children');
    $scope.ratePlanName=commonDataSharingFactory.getGuestSelectedRatePlan();
    $scope.guestNameTitle=commonDataSharingFactory.getGuestNameTitle();
    $scope.guestFirstName=commonDataSharingFactory.getGuestFirstName();
    $scope.guestLastName=commonDataSharingFactory.getGuestLastName();
    $scope.guestAddress1=commonDataSharingFactory.getGuestAddressLine1();
    $scope.guestAddress2=commonDataSharingFactory.getGuestAddressLine2();
    $scope.guestCountry=commonDataSharingFactory.getGuestCountry();
    $scope.guestState=commonDataSharingFactory.getGuestState();
    $scope.guestCity=commonDataSharingFactory.getGuestCity();
    $scope.guestPincode=commonDataSharingFactory.getGuestPincode();
    $scope.guestPhone=commonDataSharingFactory.getGuestPhoneNumber();
    $scope.guestEmail=commonDataSharingFactory.getGuestEmailAddress();
    var a = moment([localStorage.getItem('checkOutYear'), 0, localStorage.getItem('checkOutDay')]);
	var b = moment([localStorage.getItem('checkinYear'), 0, localStorage.getItem('checkinDay')]);
    var days=a.diff(b, 'days');
    var singleRoomAmt=commonDataSharingFactory.getTotalAmount();
	var totalamount=Math.round(singleRoomAmt * days);
    //$scope.totalAmount=totalamount;
    $scope.totalAmount=localStorage.getItem('totalAmount');
    $scope.roomAmount=commonDataSharingFactory.getTotalAmount();
    $scope.stayAmountDetails={"date":"FEB 20, 2015","amount":"5000"};

    $scope.redirectToPaymentGateWay=function(){
        if($scope.termsCheckbox ==true && $scope.cancellationCheckbox == true){
        	//alert($scope.termsCheckbox);
        	reviewAndPayFactory.sendDataToPaymentGateway($scope.totalAmount,$scope.guestFirstName,$scope.guestAddress1,$scope.guestPhone,$scope.guestEmail);
    	}else{
    	    $('.errorcount1').empty();
    	    if($scope.termsCheckbox ==false || $scope.termsCheckbox==undefined){
                    $('.errorcount1').append('<div class="errwp clearfix"><div class="alrtIc"></div><p>Please Agree to the Terms and Conditions.</p></div>');
    	    }
    	    if($scope.cancellationCheckbox ==false || $scope.cancellationCheckbox == undefined){
                    $('.errorcount1').append('<div class="errwp clearfix"><div class="alrtIc"></div><p>Please Agree to the Cancellation and Refund Policy.</p></div>');
            }

    	}

    }

    $scope.closeGuestDetailsEditForm=function()
    {
        reviewAndPayFactory.closeGuestDetailEditForm();
    }
    $scope.updateUserDetails=function(){
            //if($scope.termsCheckbox && $scope.cancellationCheckbox == 'true'){
            	//alert($scope.termsCheckbox);

            	reviewAndPayFactory.updateUserProfileDetails($scope);
        	//}

        }


}]);


//factory
reservationModule.factory('reviewAndPayFactory',['$http','$q','$window','commonDataSharingFactory', function($http,$q,$window,commonDataSharingFactory){
return {
    sendDataToPaymentGateway:function(amount,name,address,phone,email){
        var deferred = $q.defer();
        var tid=moment().format('DDMMYYHHmmSSS');
        localStorage.setItem('tid',tid);
        var bid=sessionStorage.getItem("bid");
        //alert('inside function');
            $http({
                  method: 'POST',
                  url: '/itconline/ccavenue/requesthandler',
                    params: {
                        //tid:tid,
                        merchant_id:"40408",
                        order_id:bid,
                        currency:"INR",
                        amount:amount,
                        redirect_url:"https://itc-hotels.net.in/itconline/ccavenue/responsehandler",
                        cancel_url:"https://itc-hotels.net.in/itconline/ccavenue/responsehandler",
                        language:"EN",
                        billing_name:name,
                        billing_address:address,
                        billing_city:"Bangalore",
                        billing_state:"Karnataka",
                        billing_zip:"560069",
                        billing_country:"India",
                        billing_tel:phone,
                        billing_email:email,
                        customer_identifier:bid
                    }

                }).then(function successCallback(response) {
                    //console.log(JSON.stringify(response.data));
                    //return response.data;
                	//var data=response.data;
                	$window.location.href=data=response.data;
                    deferred.resolve(response.data);
                }, function errorCallback(response) {
                    console.log('ajax call failed to get Destinations for hotels reservation page.');
                    deferred.reject(response.data);
            });
        return deferred.promise
    },

    closeGuestDetailEditForm:function()
    {
        $("#editDetailsSummaryForm").attr("style","display:none");
        $("#editDetailsSummaryBlock").attr("style","display:block");
    },

    updateUserProfileDetails:function($scope){
    var hotelName=$scope.hotelName;
    //nalDetailsPageFactory.saveDataToDb($scope.hotelName,commonDataSharingFactory.getHotelAddress1(),"empty",commonDataSharingFactory.getHotelPhone(),commonDataSharingFactory.getHotelId(),commonDataSharingFactory.getRoomId(),commonDataSharingFactory.getRoomName(),localStorage.getItem('planID'),commonDataSharingFactory.getGuestSelectedRatePlan(),localStorage.getItem('checkinDate'),localStorage.getItem('checkoutDate'),days,localStorage.getItem('rooms'),localStorage.getItem('adults'),localStorage.getItem('children'),$scope.userTitle,$scope.userFirstName,$scope.userLastName,$scope.userAddr1,$scope.userAddr2,$scope.userEmailId,$scope.userMobileNumber,totalamount,$scope.userCity,$scope.userState,$scope.userCountry,$scope.userPincode
        var deferred = $q.defer();
                    //var city=$scope.userCity;
                    //var state=$scope.userState;
                    //var country=$scope.userCountry;
                    //var countryCode=getCounryCode(country);
                    //var chainCode=commonDataSharingFactory.getChainCode();
                    var chainCode=commonDataSharingFactory.getChainCode();
                    var hotelCode=commonDataSharingFactory.getHotelCode();
                    var checkoutDate=localStorage.getItem('checkoutDate');
                    var checkinDate=localStorage.getItem('checkinDate');
                    //var postalCode=$scope.userPincode;
                    var roomTypeCode=commonDataSharingFactory.getRoomTypeCode();
                    var ratePlanCode=commonDataSharingFactory.getRatePlanCode();
                	var currentTime=moment().format("THH:mm:SS");
                    checkinDate=moment(checkinDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");
                    checkoutDate=moment(checkoutDate+currentTime,"YYYY-MM-DDTHH:mm:SS").format("YYYY-MM-DDTHH:mm:SS");

                    var a = moment([localStorage.getItem('checkOutYear'), 0, localStorage.getItem('checkOutDay')]);
                    var b = moment([localStorage.getItem('checkinYear'), 0, localStorage.getItem('checkinDay')]);
                    var days=a.diff(b, 'days');
                    var singleRoomAmt=commonDataSharingFactory.getTotalAmount();
                    var totalAmount=Math.round(singleRoomAmt * days);

                    var tid=localStorage.getItem('tid');
                    //alert('inside function');
                        $http({
                              method: 'POST',
                              url: '/itconline/saveReservationData',
                                params: {
                                    chainCode:chainCode,
                                    hotelCode:hotelCode,
                                    tid:tid,
                                    bid:sessionStorage.getItem("bid"),
                                    formType:'update',
                                    city:$("#guestSuCity").val(),
                                    state:$("#guestSuState").val(),
                                    country:$("#guestSuCountry").val(),
                                    postalCode:$("#guestSuPincode").val(),
                                    hotelType:commonDataSharingFactory.getHotelCategory(),
                                    hotelName:hotelName,
                                    hotelAddress1:commonDataSharingFactory.getHotelAddress1(),
                                    hotelAddress2:commonDataSharingFactory.getHotelAddress2(),
                                    hotelContact:commonDataSharingFactory.getHotelPhone(),
                                    hotelId:commonDataSharingFactory.getHotelPhone(),
                                    roomId:commonDataSharingFactory.getRoomId(),
                                    roomName:commonDataSharingFactory.getRoomName(),
                                    planId:localStorage.getItem('planID'),
                                    planName:commonDataSharingFactory.getGuestSelectedRatePlan(),
                                    checkinDate:checkinDate,
                                    checkoutDate:checkoutDate,
                                    durationOfStay:days,
                                    numberOfRooms:localStorage.getItem("rooms"),
                                    numberOfAdults:localStorage.getItem("adults"),
                                    numberOfChildrens:localStorage.getItem("children"),
                                    guestTitle:$("#guestSuNameTitle").val(),
                                    guestFirstName:$("#guestSuFirstName").val(),
                                    guestLastName:$("#guestSuLastName").val(),
                                    guestAddress1:$("#guestSuAddress1").val(),
                                    guestAddress2:$("#guestSuAddress2").val(),
                                    guestPhoneNumber:$("#guestSuPhone").val(),
                                    guestEmailId:$("#guestSuEmail").val(),
                                    totalAmount:totalAmount,
                                    ratePlanCode:ratePlanCode,
                                    roomTypeCode:roomTypeCode
                                }

                            }).then(function successCallback(response) {
                                //console.log(JSON.stringify(response.data));
                                //return response.data;
                                //var data=response.data;
                                //$window.location.href=data=response.data;

                                    if(response.data=='updated')
                                    {
                                       $scope.guestNameTitle=$("#guestSuNameTitle").val();
                                       $scope.guestFirstName=$("#guestSuFirstName").val();
                                       $scope.guestLastName=$("#guestSuLastName").val();
                                       $scope.guestAddress1=$("#guestSuAddress1").val();
                                       $scope.guestAddress2=$("#guestSuAddress2").val();
                                       $scope.guestCountry=$("#guestSuCountry").val();
                                       $scope.guestState=$("#guestSuState").val();
                                       $scope.guestCity=$("#guestSuCity").val();
                                       $scope.guestPincode=$("#guestSuPincode").val();
                                       $scope.guestPhone=$("#guestSuPhone").val();
                                       $scope.guestEmail=$("#guestSuEmail").val();
                                       $("#editDetailsSummaryForm").attr("style","display:none");
                                       $("#editDetailsSummaryBlock").attr("style","display:block");

                                    }
                                    else
                                    {
                                        $("#editDetailsSummaryForm").attr("style","display:none");
                                        $("#editDetailsSummaryBlock").attr("style","display:block");
                                    }



                                deferred.resolve(response.data);
                            }, function errorCallback(response) {
                                console.log('ajax call failed');
                                deferred.reject(response.data);
                        });
                    return deferred.promise


        }


   }
}]);


reservationModule.controller('compareHotelsController',['$scope','commonDataSharingFactory','$location',function($scope,commonDataSharingFactory,$location){
var compareHotelsData=JSON.stringify(commonDataSharingFactory.getCompareHotelsDetails());
compareHotelsData=JSON.parse(compareHotelsData);
$scope.compareHotels=compareHotelsData;
    //alert($scope.compareHotels);

$scope.removeThisHotel=function(index)
{
    index=index-1;

    var jsonObj=new Object();
    var jsonArr=[];
    if($scope.compareHotels.hotels.length>2)
    {
        for(var jsonIndex=0;jsonIndex<$scope.compareHotels.hotels.length;jsonIndex++)
        {
            if(jsonIndex!=index)
            {
                jsonArr.push($scope.compareHotels.hotels[jsonIndex]);
            }
        }
        jsonObj["hotels"]=jsonArr;
        $scope.compareHotels=jsonObj;
    }
}

$scope.redirectToPreviousTab=function()
{
$location.path('/');
}

$scope.redirectToRoomSelectionPage=function(hotelCategory,chainCode,hotelCode,hotelPagePath,hotelId,hotelName,hotelEmail,hotelPhone,hotelAddress,hotelLocation){
		commonDataSharingFactory.setHotelCategory(hotelCategory);
		commonDataSharingFactory.setChainCode(chainCode);
		commonDataSharingFactory.setHotelCode(hotelCode);
        commonDataSharingFactory.setHotelPagePath(hotelPagePath);
		commonDataSharingFactory.setHotelName(hotelName);
		commonDataSharingFactory.setHotelId(hotelId);
        commonDataSharingFactory.setHotelAddress1(hotelAddress);
        commonDataSharingFactory.setHotelPhone(hotelPhone);
        commonDataSharingFactory.setHotelEmail(hotelEmail);
        commonDataSharingFactory.setHotelLocation(hotelLocation);
        if(hotelCategory=='online')
        {
			if(hotelId=='ratePlan')
            {
				commonDataSharingFactory.setIsPromoRatePlan=true;
            }
            else
            {
				commonDataSharingFactory.setIsPromoRatePlan=false;
            }
        }
        else
        {
			commonDataSharingFactory.setIsPromoRatePlan=false;
        }
		commonDataSharingFactory.setHotelLocation($scope.Location);

        localStorage.setItem('hotelId',hotelId);
		$location.path('/roomSelection')
    }

}]);

//common data sharing factory

reservationModule.factory('commonDataSharingFactory',function(){
	var hotelName='';
    var hotelId='';
    var hotelLocation='';
    var roomId='';
    var roomName='';
    var hotelAddress1='';
    var hotelAddress2='';
    var hotelPhone='';
    var hotelEmail='';
    var hotelImagePath='';
    var guestCheckinDate='';
    var guestCheckinDay='';
    var guestCheckOutDate='';
    var guestCheckOutDay='';
    var guestTotalStayDuration='';
    var guestSelectedRoom='';
    var guestSelectedRoomCount='';
    var guestSelectedAdultCount='';
    var guestSelectedChildCount='';
    var guestSelectedRoom='';
    var guestSelectedRatePlan='';
    var guestSelectedAddon=[];
    var roomPointsPerNight='';
    var roomAmountPerNight='';
    var rateInclusions=[];
    var totalTaxAmount=[];
    var guestDepositAmountPayable='';
    var guestClubItcNumber='';
	var guestNameTitle='';
    var guestFirstName='';
    var guestLastName='';
    var guestAddressLine1='';
	var guestAddressLine2='';
    var guestPhoneNumber='';
    var guestEmailAddress='';
    var guestCountry='';
    var guestState='';
    var guestCity='';
    var guestPincode='';
    var guestId='';
    var totalAmount='';
    var balanceAmount='';
    var airportArrivalDetails='';
    var airportDepartureDetails=''
    var hotelCategory='';
    var chainCode='';
    var hotelCode='';
    var hotelPagePath='';
    var isPromoRatePlan=false;
    var startDate;
    var endDate;
    var numberOfAdults;
    var numberOfChildrens;
    var numberOfRooms;
    var roomTypeCode;
    var ratePlanCode;
    var compareHotelsDetails;
    var dropdownValueList;
    var roomRedirect;
    var previousTabData;

    return {
        setCompareHotelsDetails:function(data)
        {
            compareHotelsDetails = data;
        },
        getCompareHotelsDetails: function(){
            return compareHotelsDetails;
        },

        setPreviousTabData:function(data)
        {
            previousTabData = data;
        },
        getPreviousTabData: function(){
            return previousTabData;
        },

        setDropdownValuesList:function(data)
                {
                    dropdownValueList = data;
                },
                getDropdownValuesList: function(){
                    return dropdownValueList;
                },

        setGuestCountry:function(data)
        {
            guestCountry = data;
        },
        getGuestCountry: function(){
            return guestCountry;
        },

        setGuestState:function(data)
        {
            guestState = data;
        },
        getGuestState: function(){
            return guestState;
        },

        setGuestCity:function(data)
        {
            guestCity = data;
        },
        getGuestCity: function(){
            return guestCity;
        },

        setGuestPincode:function(data)
        {
            guestPincode = data;
        },
        getGuestPincode: function(){
            return guestPincode;
        },

        setNumberOfRooms:function(data)
        {
            numberOfRooms = data;
        },
        getNumberOfRooms: function(){
            return numberOfRooms;
        },

        setRoomTypeCode:function(data)
        {
            roomTypeCode = data;
        },
        getRoomTypeCode: function(){
            return roomTypeCode;
        },

        setRatePlanCode:function(data)
        {
            ratePlanCode = data;
        },
        getRatePlanCode: function(){
            return ratePlanCode;
        },

        setHotelName:function(data)
        {
            hotelName = data;
        },
        getHotelName: function(){
            return hotelName;
        },

        setStartDate:function(data)
        {
            startDate = data;
        },
        getStartDate: function(){
            return startDate;
        },

        setEndDate:function(data)
        {
            endDate = data;
        },
        getEndDate: function(){
            return endDate;
        },

        setNumberOfAdults:function(data)
        {
            numberOfAdults = data;
        },
        getNumberOfAdults: function(){
            return numberOfAdults;
        },

        setNumberOfChildrens:function(data)
                {
                    numberOfChildrens = data;
                },
                getNumberOfChildrens: function(){
                    return numberOfChildrens;
                },

        setIsPromoRatePlan:function(data)
        {
            isPromoRatePlan = data;
        },
        getIsPromoRatePlan: function(){
            return isPromoRatePlan;
        },

        setHotelCategory:function(data)
        {
           hotelCategory  = data;
        },
        getHotelCategory: function(){
            return hotelCategory;
        },

        setChainCode:function(data)
        {
           chainCode  = data;
        },
        getChainCode: function(){
            return chainCode;
        },

        setHotelCode:function(data)
        {
           hotelCode  = data;
        },
        getHotelCode: function(){
            return hotelCode;
        },

        setHotelPagePath:function(data)
        {
           hotelPagePath  = data;
        },
        getHotelPagePath: function(){
            return hotelPagePath;
        },

        setHotelId:function(data)
        {
            hotelId = data;
        },
        getHotelId: function(){
            return hotelId;
        },
        setHotelLocation:function(data)
        {
            hotelLocation = data;
        },
        getHotelLocation: function(){
            return hotelLocation;
        },
        setRoomName:function(data)
        {
            roomName = data;
        },
        getRoomName: function(){
            return roomName;
        },
        setRoomId:function(data)
        {
            roomId = data;
        },
        getRoomId: function(){
            return roomId;
        },
        setHotelAddress1: function(data){
            hotelAddress1 = data;
        },
        getHotelAddress1: function(){
            return hotelAddress1;
        },
        setHotelAddress2: function(data){
            hotelAddress2 = data;
        },
        getHotelAddress2: function(){
            return hotelAddress2;
        },
        setHotelPhone: function(data){
            hotelPhone = data;
        },
        getHotelPhone: function(){
            return hotelPhone;
        },
        setHotelEmail: function(data){
            hotelEmail = data;
        },
        getHotelEmail: function(){
            return hotelEmail;
        },
        setHotelImagePath: function(data){
            hotelImagePath = data;
        },
        getHotelImagePath: function(){
            return hotelImagePath;
        },
        setGuestCheckinDate: function(data){
            guestCheckinDate = data;
        },
        getGuestCheckinDate: function(){
            return guestCheckinDate;
        },
        setGuestCheckinDay: function(data){
            guestCheckinDay = data;
        },
        getGuestCheckinDay: function(){
            return guestCheckinDay;
        },
        setGuestCheckOutDate: function(data){
            guestCheckOutDate = data;
        },
        getGuestCheckOutDate: function(){
            return guestCheckOutDate;
        },
        setGuestCheckOutDay: function(data){
            guestCheckOutDay = data;
        },
        getGuestCheckOutDay: function(){
            return guestCheckOutDay;
        },
        setGuestTotalStayDuration: function(data){
            guestTotalStayDuration = data;
        },
        getGuestTotalStayDuration: function(){
            return guestTotalStayDuration;
        },
        setGuestSelectedRoom: function(data){
            guestSelectedRoom = data;
        },
        getGuestSelectedRoom: function() {
            return guestSelectedRoom;
        },
        setGuestSelectedRoomCount: function(data){
            guestSelectedRoomCount = data;
        },
        getGuestSelectedRoomCount: function(){
            return guestSelectedRoomCount;
        },
        setGuestSelectedAdultCount: function(data){
            guestSelectedAdultCount = data;
        },
        getGuestSelectedAdultCount: function(){
            return guestSelectedAdultCount;
        },
        setGuestSelectedChildCount: function(data){
            guestSelectedChildCount = data;
        },
        getGuestSelectedChildCount: function(){
            return guestSelectedChildCount;
        },
        setGuestSelectedRoom: function(data){
            guestSelectedRoom = data;
        },
        getGuestSelectedRoom: function(){
            return guestSelectedRoom;
        },
        setGuestSelectedRatePlan: function(data){
            guestSelectedRatePlan = data;
        },
        getGuestSelectedRatePlan: function(){
            return guestSelectedRatePlan;
        },
        setGuestSelectedAddon: function(addOnName,addOnAmount){
            var addOn={'addOnName':addOnName,'addOnAmount':addOnAmount};
            guestSelectedAddon.push(addOn) ;
        },
        getGuestSelectedAddon: function(){
            return guestSelectedAddon;
        },
        setRoomPointsPerNight: function(data){
            roomPointsPerNight = data;
        },
        getRoomPointsPerNight: function(){
            return roomPointsPerNight;
        },
        setRoomAmountPerNight: function(data){
            roomAmountPerNight = data;
        },
        getRoomAmountPerNight: function(){
            return roomAmountPerNight;
        },
        setRateInclusions: function(data){
            rateInclusions.push(data);
        },
        getRateInclusions: function(){
            return rateInclusions;
        },
        setTotalTaxAmount: function(taxType,taxPercentage,taxAmount){
            var taxAmt={'TaxType':taxType,'TaxPercentage':taxPercentage,'TaxAmount':taxAmount};
            totalTaxAmount.push(taxAmt);
        },
        getTotalTaxAmount: function(){
            return totalTaxAmount;
        },
        setGuestDepositAmountPayable: function(data){
            guestDepositAmountPayable = data;
        },
        getGuestDepositAmountPayable: function(){
            return guestDepositAmountPayable;
        },
        setGuestClubItcNumber: function(data){
            guestClubItcNumber = data;
        },
        getGuestClubItcNumber: function(){
            return guestClubItcNumber;
        },
        setGuestNameTitle: function(data){
            guestNameTitle = data;
        },
        getGuestNameTitle: function(){
            return guestNameTitle;
        },
        setGuestFirstName: function(data){
            guestFirstName = data;
        },
        getGuestFirstName: function(){
            return guestFirstName;
        },
        setGuestLastName: function(data){
            guestLastName = data;
        },
        getGuestLastName: function(){
            return guestLastName;
        },
        setGuestAddressLine1: function(data){
            guestAddressLine1 = data;
        },
        getGuestAddressLine1: function(){
            return guestAddressLine1;
        },
        setGuestAddressLine2: function(data){
            guestAddressLine2 = data;
        },
        getGuestAddressLine2: function(){
            return guestAddressLine2;
        },
        setGuestPhoneNumber: function(data){
            guestPhoneNumber = data;
        },
        getGuestPhoneNumber: function(){
            return guestPhoneNumber;
        },
        setGuestEmailAddress: function(data){
            guestEmailAddress = data;
        },
        getGuestEmailAddress: function(){
            return guestEmailAddress;
        },
        setGuestId: function(data){
            guestId = data;
        },
        getGuestId: function(){
            return guestId;
        },
        setTotalAmount: function(data){
            totalAmount = data;
        },
        getTotalAmount: function(){
            return totalAmount;

        },
        setBalanceAmount: function(data){
            balanceAmount = data;
        },
        getBalanceAmount: function(){
            return balanceAmount;
        },
        setAirportArrivalDetails: function(arrivalFlightNumber,arrivalTimeHr,arrivalTimeMin,arrivalAirportName){
            console.log(arrivalFlightNumber,arrivalTimeHr,arrivalTimeMin,arrivalAirportName);
            airportArrivalDetails = {'arrivalFlightNumber':arrivalFlightNumber,'arrivalTimeHr':arrivalTimeHr,'arrivalTimeMin':arrivalTimeMin,'arrivalAirportName':arrivalAirportName};
        },
        getAirportArrivalDetails: function(){
            return airportArrivalDetails;
        },
        setAirportDepartureDetails: function(departureFlightNumber,departureTimeHr,departureTimeMin,departureAirportName){
            console.log(departureFlightNumber,departureTimeHr,departureTimeMin,departureAirportName);
            airportDepartureDetails = {'departureFlightNumber':departureFlightNumber,'departureTimeHr':departureTimeHr,'departureTimeMin':departureTimeMin,'departureAirportName':departureAirportName};
        },
        getAirportDepartureDetails: function(){
            return airportDepartureDetails;
        },
        setRoomRedirect: function(data){
            roomRedirect = data;
        },
        getRoomRedirect: function(){
            return roomRedirect;
        }

	}

});
